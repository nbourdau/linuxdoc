

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>linuxdoc.kernel_doc &mdash; LinuxDoc 20170614 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="LinuxDoc 20170614 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> LinuxDoc
          

          
          </a>

          
            
            
              <div class="version">
                20170614
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Install LinuxDoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linuxdoc-howto/index.html">LinuxDoc HowTo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cmd-line.html">Command line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux.html">Patch Linux Kernel Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../linuxdoc-api/linuxdoc.html">linuxdoc package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">LinuxDoc</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>linuxdoc.kernel_doc</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for linuxdoc.kernel_doc</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8; mode: python -*-</span>
<span class="c1"># pylint: disable=C0103,C0302,C0325,R0912,R0914,R0915,W0221</span>

<span class="sa">u</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    kernel_doc</span>
<span class="sd">    ~~~~~~~~~~</span>

<span class="sd">    Implementation of the ``kernel-doc`` parser.</span>

<span class="sd">    :copyright:  Copyright (C) 2016  Markus Heiser</span>
<span class="sd">    :license:    GPL Version 2, June 1991 see Linux/COPYING for details.</span>

<span class="sd">    The kernel-doc parser extracts documentation from Linux kernel&#39;s source code</span>
<span class="sd">    comments. This implements the :ref:`kernel-doc markup &lt;kernel-doc-intro&gt;`.</span>

<span class="sd">    This module provides an API -- which could be used by a sphinx-doc generator</span>
<span class="sd">    extension -- and a command-line interface, see ``--help``::</span>

<span class="sd">        $ kernel-doc --help</span>

<span class="sd">    But, the command-line is only for test, normally you don&#39;t need it.</span>

<span class="sd">    Compared with the Perl kernel-doc script, this implementation has additional</span>
<span class="sd">    features like *parse options* for a smooth integration of reStructuredText</span>
<span class="sd">    (reST) markup in the kernel&#39;s source code comments. In addition, this</span>
<span class="sd">    rewrite brings the functionalities, which has been spread in *docproc* and</span>
<span class="sd">    make files (e.g. working with *EXPORTED_SYMBOLS*) back to the kernel-doc</span>
<span class="sd">    parse process. In combination with a (separate) *kernel-doc* reST directive</span>
<span class="sd">    (which uses this module), the documentation generation becomes more clear</span>
<span class="sd">    and flexible.</span>

<span class="sd">    The architecture is simple and consists of three types of objects (three</span>
<span class="sd">    classes).</span>

<span class="sd">    * class Parser: The parser parses the source-file and dumps extracted</span>
<span class="sd">      kernel-doc data.</span>

<span class="sd">    * subclasses of class TranslatorAPI: to translate the dumped kernel-doc data</span>
<span class="sd">      into output formats. There exists two implementations:</span>

<span class="sd">      - class NullTranslator: translates nothing, just parse</span>

<span class="sd">      - class ReSTTranslator(TranslatorAPI): translates dumped kernel-doc data</span>
<span class="sd">        to reST markup.</span>

<span class="sd">    * class ParseOptions: a container full with options to control parsing an</span>
<span class="sd">      translation.</span>

<span class="sd">    With the NullTranslator a source file is parsed only once while different</span>
<span class="sd">    output could be generated (multiple times) just by changing the Translator</span>
<span class="sd">    (e.g. with the ReSTTranslator) and the option container.</span>

<span class="sd">    With parsing the source files only once, the building time is reduced n-times.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># ==============================================================================</span>
<span class="c1"># imports</span>
<span class="c1"># ==============================================================================</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">fspath</span> <span class="k">import</span> <span class="n">OS_ENV</span>

<span class="c1"># ==============================================================================</span>
<span class="c1"># common globals</span>
<span class="c1"># ==============================================================================</span>

<span class="c1"># The version numbering follows numbering of the specification</span>
<span class="c1"># (Documentation/books/kernel-doc-HOWTO).</span>
<span class="n">__version__</span>  <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>

<span class="c1"># ==============================================================================</span>
<span class="c1"># regular expresssions and helper used by the parser and the translator</span>
<span class="c1"># ==============================================================================</span>

<div class="viewcode-block" id="RE"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.RE">[docs]</a><span class="k">class</span> <span class="nc">RE</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;regular expression that stores last match (like Perl&#39;s ``=~`` operator)&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_match</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="RE.match"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.RE.match">[docs]</a>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_match</span></div>

<div class="viewcode-block" id="RE.search"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.RE.search">[docs]</a>    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_match</span></div>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">group</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">group</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;group index out of range (max </span><span class="si">%s</span><span class="s2"> groups)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">groups</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;nothing hase matched / no groups&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">group</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>

<span class="c1"># these regular expresions has been *stolen* from the kernel-doc perl script.</span>

<span class="n">doc_start</span>        <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^/\*\*\s*$&quot;</span><span class="p">)</span>  <span class="c1"># Allow whitespace at end of comment start.</span>
<span class="n">doc_end</span>          <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*\*+/&quot;</span><span class="p">)</span>
<span class="n">doc_com</span>          <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*\*\s*&quot;</span><span class="p">)</span>
<span class="n">doc_com_section</span>  <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*\*\s{1,8}&quot;</span><span class="p">)</span> <span class="c1"># more than 8 spaces (one tab) as prefix is not a new section comment</span>
<span class="n">doc_com_body</span>     <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*\* ?&quot;</span><span class="p">)</span>
<span class="n">doc_decl</span>         <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">doc_com</span><span class="o">.</span><span class="n">pattern</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;(\w+)&quot;</span><span class="p">)</span>
<span class="c1">#doc_decl_ident   = RE(r&quot;\s*([\w\s]+?)\s*[\(\)]\s*[-:]&quot;)</span>
<span class="n">doc_decl_ident</span>   <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">doc_com</span><span class="o">.</span><span class="n">pattern</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;(struct|union|enum|typedef|function)\s*(\w+)&quot;</span><span class="p">)</span>
<span class="n">doc_decl_purpose</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[-:](.*)$&quot;</span><span class="p">)</span>

<span class="c1"># except pattern like &quot;http://&quot;, a whitespace is required after the colon</span>
<span class="n">doc_sect_except</span>  <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">doc_com</span><span class="o">.</span><span class="n">pattern</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;[^\s@](.*)?:[^\s]&quot;</span><span class="p">)</span>

<span class="c1">#doc_sect = RE(doc_com.pattern + r&quot;([&quot; + doc_special.pattern + r&quot;]?[\w\s]+):(.*)&quot;)</span>
<span class="c1"># &quot;section header:&quot; names must be unique per function (or struct,union, typedef,</span>
<span class="c1"># enum). Additional condition: the header name should have 3 characters at least!</span>
<span class="n">doc_sect</span>  <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">doc_com_section</span><span class="o">.</span><span class="n">pattern</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;(&quot;</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;@\w[^:]*&quot;</span>                                 <span class="c1"># &quot;@foo: lorem&quot; or</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;@\w[.\w]+[^:]*&quot;</span>                    <span class="c1"># &quot;@foo.bar: lorem&quot; or</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\@\.\.\.&quot;</span>                          <span class="c1"># ellipsis &quot;@...: lorem&quot; or</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\w[\w\s]+\w&quot;</span>                       <span class="c1"># e.g. &quot;Return: lorem&quot;</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;)&quot;</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;:(.*?)\s*$&quot;</span><span class="p">)</span>   <span class="c1"># this matches also strings like &quot;http://...&quot; (doc_sect_except)</span>

<span class="n">doc_sect_reST</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">doc_com_section</span><span class="o">.</span><span class="n">pattern</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;(&quot;</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;@\w[^:]*&quot;</span>                                 <span class="c1"># &quot;@foo: lorem&quot; or</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;@\w[.\w]+[^:]*&quot;</span>                    <span class="c1"># &quot;@foo.bar: lorem&quot; or</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\@\.\.\.&quot;</span>                          <span class="c1"># ellipsis &quot;@...: lorem&quot; or</span>
               <span class="c1"># a tribute to vintage markups, when in reST mode ...</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;|description|context|returns?|notes?|examples?|introduction|intro&quot;</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;)&quot;</span>
               <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;:(.*?)\s*$&quot;</span>    <span class="c1"># this matches also strings like &quot;http://...&quot; (doc_sect_except)</span>
               <span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>

<span class="n">reST_sect</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">doc_com_section</span><span class="o">.</span><span class="n">pattern</span>
              <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;(&quot;</span>
              <span class="sa">r</span><span class="s2">&quot;\w[\w\s]+\w&quot;</span>
              <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;)&quot;</span>
              <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;:\s*$&quot;</span><span class="p">)</span>

<span class="n">doc_content</span>      <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">doc_com_body</span><span class="o">.</span><span class="n">pattern</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;(.*)&quot;</span><span class="p">)</span>
<span class="n">doc_block</span>        <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">doc_com</span><span class="o">.</span><span class="n">pattern</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;DOC:\s*(.*)?&quot;</span><span class="p">)</span>

<span class="c1"># state: 5 - gathering documentation outside main block</span>
<span class="n">doc_state5_start</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*/\*\*\s*$&quot;</span><span class="p">)</span>
<span class="n">doc_state5_sect</span>  <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*\*\s*(@[\w\s]+):(.*)&quot;</span><span class="p">)</span>
<span class="n">doc_state5_end</span>   <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*\*/\s*$&quot;</span><span class="p">)</span>
<span class="n">doc_state5_oneline</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*/\*\*\s*(@[\w\s]+):\s*(.*)\s*\*/\s*$&quot;</span><span class="p">)</span>

<span class="c1"># match expressions used to find embedded type information</span>
<span class="n">type_enum_full</span>    <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=\s)\&amp;(enum)\s*([_\w]+)&quot;</span><span class="p">)</span>
<span class="n">type_struct_full</span>  <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=\s)\&amp;(struct)\s*([_\w]+)&quot;</span><span class="p">)</span>
<span class="n">type_typedef_full</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=\s)\&amp;(typedef)\s*([_\w]+)&quot;</span><span class="p">)</span>
<span class="n">type_union_full</span>   <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=\s)\&amp;(union)\s*([_\w]+)&quot;</span><span class="p">)</span>
<span class="n">type_member</span>       <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=\s)\&amp;([_\w]+)((\.|-&gt;)[_\w]+)&quot;</span><span class="p">)</span>
<span class="n">type_member_func</span>  <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="n">type_member</span><span class="o">.</span><span class="n">pattern</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;\(\)&quot;</span><span class="p">)</span>
<span class="n">type_func</span>         <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=\s)(\w+)(?&lt;!</span><span class="se">\\</span><span class="s2">)\(\)&quot;</span><span class="p">)</span>
<span class="n">type_constant</span>     <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=\s)\%([-_\w]+)&quot;</span><span class="p">)</span>
<span class="n">type_param</span>        <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=\s)\@(\w+)&quot;</span><span class="p">)</span>
<span class="n">type_env</span>          <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=\s)(\$\w+)&quot;</span><span class="p">)</span>
<span class="n">type_struct</span>       <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=\s)\&amp;((struct\s*)*[_\w]+)&quot;</span><span class="p">)</span>

<span class="n">esc_type_prefix</span>  <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">([\@\%\&amp;\$\(])&quot;</span><span class="p">)</span>

<span class="n">CR_NL</span>            <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\r\n]&quot;</span><span class="p">)</span>
<span class="n">C99_comments</span>     <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;//.*$&quot;</span><span class="p">)</span>
<span class="n">C89_comments</span>     <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/\*.*?\*/&quot;</span><span class="p">)</span>

<span class="n">C_STRUCT</span>         <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;struct\s+(\w+)\s*{(.*)}&quot;</span><span class="p">)</span>
<span class="n">C_UNION</span>          <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;union\s+(\w+)\s*{(.*)}&quot;</span><span class="p">)</span>
<span class="n">C_STRUCT_UNION</span>   <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(struct|union)\s+(\w+)\s*{(.*)}&quot;</span><span class="p">)</span>
<span class="n">C_ENUM</span>           <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;enum\s+(\w+)\s*{(.*)}&quot;</span><span class="p">)</span>
<span class="n">C_TYPEDEF</span>        <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;typedef.*\s+(\w+)\s*;&quot;</span><span class="p">)</span>

<span class="c1"># typedef of a function pointer</span>
<span class="n">C_FUNC_TYPEDEF</span>   <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;typedef\s+(\w+)\s*\(\*\s*(\w\S+)\s*\)\s*\((.*)\);&quot;</span><span class="p">)</span>
<span class="n">C_FUNC_TYPEDEF_2</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;typedef\s+(\w+)\s+(\w\S+)\s*\((.*)\);&quot;</span><span class="p">)</span>

<span class="n">MACRO</span>            <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^#&quot;</span><span class="p">)</span>
<span class="n">MACRO_define</span>     <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^#\s*define\s+&quot;</span><span class="p">)</span>

<span class="n">SYSCALL_DEFINE</span>   <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*SYSCALL_DEFINE.*\(&quot;</span><span class="p">)</span>
<span class="n">SYSCALL_DEFINE0</span>  <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*SYSCALL_DEFINE0&quot;</span><span class="p">)</span>

<span class="n">TP_PROTO</span>                 <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;TP_PROTO\((.*?)\)&quot;</span><span class="p">)</span>
<span class="n">TRACE_EVENT</span>              <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;TRACE_EVENT&quot;</span><span class="p">)</span>
<span class="n">TRACE_EVENT_name</span>         <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;TRACE_EVENT\((.*?),&quot;</span><span class="p">)</span>
<span class="n">DEFINE_EVENT</span>             <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;DEFINE_EVENT&quot;</span><span class="p">)</span>
<span class="n">DEFINE_EVENT_name</span>        <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;DEFINE_EVENT\((.*?),(.*?),&quot;</span><span class="p">)</span>
<span class="n">DEFINE_SINGLE_EVENT</span>      <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;DEFINE_SINGLE_EVENT&quot;</span><span class="p">)</span>
<span class="n">DEFINE_SINGLE_EVENT_name</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;DEFINE_SINGLE_EVENT\((.*?),&quot;</span><span class="p">)</span>

<span class="n">FUNC_PROTOTYPES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># RE(r&quot;^(\w+)\s+\(\*([a-zA-Z0-9_]+)\)\s*\(([^\(]*)\)&quot;) # match: void (*foo) (int bar);</span>
    <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^()([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s*\*+)\s*([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s+\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s+\w+\s*\*+)\s*([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s+\w+\s+\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s+\w+\s+\w+\s*\*+)\s*([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^()([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s*\*+)\s*([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s+\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s+\w+\s*\*+)\s*([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s+\w+\s+\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s+\w+\s+\w+\s*\*+)\s*([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s+\w+\s+\w+\s+\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s+\w+\s+\w+\s+\w+\s*\*+)\s*([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\w+\s+\w+\s*\*\s*\w+\s*\*+\s*)\s*([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">EXPORTED_SYMBOLS</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;^\s*(EXPORT_SYMBOL)(_GPL)?(_FUTURE)?\s*\(\s*(\w*)\s*\)\s*&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>

<span class="c1"># MODULE_AUTHOR(&quot;...&quot;); /  MODULE_DESCRIPTION(&quot;...&quot;); / MODULE_LICENSE(&quot;...&quot;);</span>
<span class="c1">#</span>
<span class="n">MODULE_INFO</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*(MODULE_)(AUTHOR|DESCRIPTION|LICENSE)\s*\(\s*&quot;([^&quot;]+)&quot;&#39;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>

<span class="n">WHITESPACE</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span>

<div class="viewcode-block" id="normalize_ws"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.normalize_ws">[docs]</a><span class="k">def</span> <span class="nf">normalize_ws</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;strip needles whitespaces.</span>

<span class="sd">    Substitute consecutive whitespaces with one single space and strip</span>
<span class="sd">    trailing/leading whitespaces&quot;&quot;&quot;</span>

    <span class="n">string</span> <span class="o">=</span> <span class="n">WHITESPACE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<span class="n">ID_CHARS</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^A-Za-z0-9\._]&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="normalize_id"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.normalize_id">[docs]</a><span class="k">def</span> <span class="nf">normalize_id</span><span class="p">(</span><span class="n">ID</span><span class="p">):</span>
    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;substitude invalid chars of the ID with ``-`` and mak it lowercase&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ID_CHARS</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span></div>

<div class="viewcode-block" id="map_text"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.map_text">[docs]</a><span class="k">def</span> <span class="nf">map_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">map_table</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">regexpr</span><span class="p">,</span> <span class="n">substitute</span> <span class="ow">in</span> <span class="n">map_table</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">substitute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">regexpr</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">substitute</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span></div>

<span class="c1"># ==============================================================================</span>
<span class="c1"># helper</span>
<span class="c1"># ==============================================================================</span>

<div class="viewcode-block" id="openTextFile"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.openTextFile">[docs]</a><span class="k">def</span> <span class="nf">openTextFile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;strict&quot;</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
        <span class="n">fname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span>
        <span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=</span><span class="n">buffering</span><span class="p">)</span></div>

<div class="viewcode-block" id="readFile"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.readFile">[docs]</a><span class="k">def</span> <span class="nf">readFile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;strict&quot;</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">openTextFile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></div>

<div class="viewcode-block" id="Container"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Container">[docs]</a><span class="k">class</span> <span class="nc">Container</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">__dict__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<span class="k">class</span> <span class="nc">DevNull</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A dev/null file descriptor.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>
<span class="n">DevNull</span> <span class="o">=</span> <span class="n">DevNull</span><span class="p">()</span>

<span class="n">KBUILD_VERBOSE</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">OS_ENV</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;KBUILD_VERBOSE&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>
<span class="n">KERNELVERSION</span>  <span class="o">=</span> <span class="n">OS_ENV</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;KERNELVERSION&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown kernel version&quot;</span><span class="p">)</span>
<span class="n">SRCTREE</span>        <span class="o">=</span> <span class="n">OS_ENV</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;srctree&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">GIT_REF</span>        <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Linux kernel source tree:&quot;</span>
                  <span class="s2">&quot; `</span><span class="si">%(rel_fname)s</span><span class="s2"> &lt;https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/&quot;</span>
                  <span class="s2">&quot;</span><span class="si">%(rel_fname)s</span><span class="s2">&gt;`__&quot;</span><span class="p">)</span>

<span class="c1"># ==============================================================================</span>
<span class="c1"># Logging stuff</span>
<span class="c1"># ==============================================================================</span>

<span class="n">STREAM</span> <span class="o">=</span> <span class="n">Container</span><span class="p">(</span>
    <span class="c1"># pipes used by the application &amp; logger</span>
    <span class="n">appl_out</span>   <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stdout__</span>
    <span class="p">,</span> <span class="n">log_out</span>  <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stderr__</span>
    <span class="p">,</span> <span class="p">)</span>

<span class="n">VERBOSE</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">KBUILD_VERBOSE</span><span class="p">)</span>
<span class="n">DEBUG</span>   <span class="o">=</span> <span class="kc">False</span>
<span class="n">INSPECT</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">QUIET</span>   <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="SimpleLog"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.SimpleLog">[docs]</a><span class="k">class</span> <span class="nc">SimpleLog</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">LOG_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(logclass)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="se">\n</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="SimpleLog.error"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.SimpleLog.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span> <span class="o">%</span> <span class="n">replace</span>
        <span class="n">replace</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">,</span> <span class="n">logclass</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">))</span>
        <span class="n">STREAM</span><span class="o">.</span><span class="n">log_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LOG_FORMAT</span> <span class="o">%</span> <span class="n">replace</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleLog.warn"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.SimpleLog.warn">[docs]</a>    <span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">QUIET</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span> <span class="o">%</span> <span class="n">replace</span>
        <span class="n">replace</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">,</span> <span class="n">logclass</span> <span class="o">=</span> <span class="s2">&quot;WARN&quot;</span><span class="p">))</span>
        <span class="n">STREAM</span><span class="o">.</span><span class="n">log_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LOG_FORMAT</span> <span class="o">%</span> <span class="n">replace</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleLog.info"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.SimpleLog.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span> <span class="o">%</span> <span class="n">replace</span>
        <span class="n">replace</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">,</span> <span class="n">logclass</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">))</span>
        <span class="n">STREAM</span><span class="o">.</span><span class="n">log_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LOG_FORMAT</span> <span class="o">%</span> <span class="n">replace</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleLog.debug"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.SimpleLog.debug">[docs]</a>    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span> <span class="o">%</span> <span class="n">replace</span>
        <span class="n">replace</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">,</span> <span class="n">logclass</span> <span class="o">=</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">))</span>
        <span class="n">STREAM</span><span class="o">.</span><span class="n">log_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LOG_FORMAT</span> <span class="o">%</span> <span class="n">replace</span><span class="p">)</span></div></div>

<span class="n">LOG</span> <span class="o">=</span> <span class="n">SimpleLog</span><span class="p">()</span>

<span class="c1"># ==============================================================================</span>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="c1"># ==============================================================================</span>

    <span class="k">global</span> <span class="n">VERBOSE</span><span class="p">,</span> <span class="n">DEBUG</span> <span class="c1"># pylint: disable=W0603</span>

    <span class="n">epilog</span> <span class="o">=</span> <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;This implementation of uses the kernel-doc parser&quot;</span>
              <span class="s2">&quot; from the linuxdoc extension, for detail informations read&quot;</span>
              <span class="s2">&quot; http://return42.github.io/sphkerneldoc/books/kernel-doc-HOWTO&quot;</span><span class="p">)</span>

    <span class="n">CLI</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Parse *kernel-doc* comments from source code&quot;</span>
            <span class="s2">&quot; and print them (with reST markup) to stdout.&quot;</span> <span class="p">)</span>
        <span class="p">,</span> <span class="n">epilog</span> <span class="o">=</span> <span class="n">epilog</span>
        <span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">)</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;files&quot;</span>
        <span class="p">,</span> <span class="n">nargs</span>   <span class="o">=</span> <span class="s2">&quot;+&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="s2">&quot;source file(s) to parse.&quot;</span><span class="p">)</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--id-prefix&quot;</span>
        <span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;A prefix for generated IDs. IDs are used as anchors by cross&quot;</span>
            <span class="s2">&quot; references. They are automaticly gernerated based on the declaration&quot;</span>
            <span class="s2">&quot; and / or section names. Declartions like &#39;open&#39; or section names&quot;</span>
            <span class="s2">&quot; like &#39;Intro&#39; are very common, to make them unique, a prefix is needed.&quot;</span>
            <span class="s2">&quot; Mostly you will choose the *module* or *include filename* as prefix.&quot;</span> <span class="p">))</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span> <span class="s2">&quot;-v&quot;</span>
        <span class="p">,</span> <span class="n">action</span>  <span class="o">=</span> <span class="s2">&quot;store_true&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="s2">&quot;verbose output with log messages to stderr&quot;</span> <span class="p">)</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--sloppy&quot;</span>
        <span class="p">,</span> <span class="n">action</span>  <span class="o">=</span> <span class="s2">&quot;store_true&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="s2">&quot;Sloppy linting, reports only severe errors.&quot;</span><span class="p">)</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--debug&quot;</span>
        <span class="p">,</span> <span class="n">action</span>  <span class="o">=</span> <span class="s2">&quot;store_true&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="s2">&quot;debug messages to stderr&quot;</span> <span class="p">)</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span>
        <span class="p">,</span> <span class="n">action</span>  <span class="o">=</span> <span class="s2">&quot;store_true&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="s2">&quot;no messages to stderr&quot;</span> <span class="p">)</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--skip-preamble&quot;</span>
        <span class="p">,</span> <span class="n">action</span>  <span class="o">=</span> <span class="s2">&quot;store_true&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="s2">&quot;skip preamble in the output&quot;</span> <span class="p">)</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--skip-epilog&quot;</span>
        <span class="p">,</span> <span class="n">action</span>  <span class="o">=</span> <span class="s2">&quot;store_true&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="s2">&quot;skip epilog in the output&quot;</span> <span class="p">)</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--list-internals&quot;</span>
        <span class="p">,</span> <span class="n">choices</span> <span class="o">=</span> <span class="n">Parser</span><span class="o">.</span><span class="n">DOC_TYPES</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">nargs</span>   <span class="o">=</span> <span class="s2">&quot;+&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="s2">&quot;list symbols, titles or whatever is documented, but *not* exported&quot;</span> <span class="p">)</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--list-exports&quot;</span>
        <span class="p">,</span> <span class="n">action</span>  <span class="o">=</span> <span class="s2">&quot;store_true&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="s2">&quot;list all symbols exported using EXPORT_SYMBOL&quot;</span> <span class="p">)</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--use-names&quot;</span>
        <span class="p">,</span> <span class="n">nargs</span>   <span class="o">=</span> <span class="s2">&quot;+&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="s2">&quot;print documentation of functions, structs or whatever title/object&quot;</span><span class="p">)</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--exported&quot;</span>
        <span class="p">,</span> <span class="n">action</span>  <span class="o">=</span> <span class="s2">&quot;store_true&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;print documentation of all symbols exported&quot;</span>
                     <span class="s2">&quot; using EXPORT_SYMBOL macros&quot;</span> <span class="p">))</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
         <span class="s2">&quot;--internal&quot;</span>
        <span class="p">,</span> <span class="n">action</span>  <span class="o">=</span> <span class="s2">&quot;store_true&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;print documentation of all symbols that are documented,&quot;</span>
                     <span class="s2">&quot; but not exported&quot;</span> <span class="p">))</span>

    <span class="n">CLI</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--markup&quot;</span>
        <span class="p">,</span> <span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;reST&quot;</span><span class="p">,</span> <span class="s2">&quot;kernel-doc&quot;</span><span class="p">]</span>
        <span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;reST&quot;</span>
        <span class="p">,</span> <span class="n">help</span>    <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Markup of the comments. Change this option only if you know&quot;</span>
            <span class="s2">&quot; what you do. New comments must be marked up with reST!&quot;</span><span class="p">))</span>

    <span class="n">CMD</span>     <span class="o">=</span> <span class="n">CLI</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">VERBOSE</span> <span class="o">=</span> <span class="n">CMD</span><span class="o">.</span><span class="n">verbose</span>
    <span class="n">DEBUG</span>   <span class="o">=</span> <span class="n">CMD</span><span class="o">.</span><span class="n">debug</span>

    <span class="k">if</span> <span class="n">CMD</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
        <span class="n">STREAM</span><span class="o">.</span><span class="n">log_out</span> <span class="o">=</span> <span class="n">DevNull</span> <span class="c1"># pylint: disable=W0201</span>

    <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;CMD: </span><span class="si">%(CMD)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">CMD</span><span class="o">=</span><span class="n">CMD</span><span class="p">)</span>

    <span class="n">retVal</span>     <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">CMD</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">ReSTTranslator</span><span class="p">()</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="n">ParseOptions</span><span class="p">(</span>
            <span class="n">fname</span>           <span class="o">=</span> <span class="n">fname</span>
            <span class="p">,</span> <span class="n">id_prefix</span>     <span class="o">=</span> <span class="n">CMD</span><span class="o">.</span><span class="n">id_prefix</span>
            <span class="p">,</span> <span class="n">skip_preamble</span> <span class="o">=</span> <span class="n">CMD</span><span class="o">.</span><span class="n">skip_preamble</span>
            <span class="p">,</span> <span class="n">skip_epilog</span>   <span class="o">=</span> <span class="n">CMD</span><span class="o">.</span><span class="n">skip_epilog</span>
            <span class="p">,</span> <span class="n">out</span>           <span class="o">=</span> <span class="n">STREAM</span><span class="o">.</span><span class="n">appl_out</span>
            <span class="p">,</span> <span class="n">markup</span>        <span class="o">=</span> <span class="n">CMD</span><span class="o">.</span><span class="n">markup</span>
            <span class="p">,</span> <span class="n">verbose_warn</span>  <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">CMD</span><span class="o">.</span><span class="n">sloppy</span><span class="p">)</span>
            <span class="p">,)</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">CMD</span><span class="o">.</span><span class="n">list_exports</span> <span class="ow">or</span> <span class="n">CMD</span><span class="o">.</span><span class="n">list_internals</span><span class="p">:</span>
            <span class="n">translator</span> <span class="o">=</span> <span class="n">ListTranslator</span><span class="p">(</span><span class="n">CMD</span><span class="o">.</span><span class="n">list_exports</span><span class="p">,</span> <span class="n">CMD</span><span class="o">.</span><span class="n">list_internals</span><span class="p">)</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">gather_context</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">CMD</span><span class="o">.</span><span class="n">use_names</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">use_names</span>  <span class="o">=</span> <span class="n">CMD</span><span class="o">.</span><span class="n">use_names</span>

        <span class="k">elif</span> <span class="n">CMD</span><span class="o">.</span><span class="n">exported</span> <span class="ow">or</span> <span class="n">CMD</span><span class="o">.</span><span class="n">internal</span><span class="p">:</span>
            <span class="c1"># gather exported symbols ...</span>
            <span class="n">src</span>   <span class="o">=</span> <span class="n">readFile</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">ctx</span>   <span class="o">=</span> <span class="n">ParserContext</span><span class="p">()</span>
            <span class="n">Parser</span><span class="o">.</span><span class="n">gather_context</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>

            <span class="n">opts</span><span class="o">.</span><span class="n">error_missing</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">use_names</span>     <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">exported_symbols</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">skip_names</span>    <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">CMD</span><span class="o">.</span><span class="n">internal</span><span class="p">:</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">use_names</span>  <span class="o">=</span> <span class="p">[]</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">skip_names</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">exported_symbols</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if non section is choosen by use-name, internal or exclude, then</span>
            <span class="c1"># use all DOC: sections</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">use_all_docs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">translator</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">retVal</span></div>

<span class="c1"># ==============================================================================</span>
<span class="c1"># API</span>
<span class="c1"># ==============================================================================</span>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="TranslatorAPI"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI">[docs]</a><span class="k">class</span> <span class="nc">TranslatorAPI</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract kernel-doc translator.</span>

<span class="sd">    :cvar list cls.HIGHLIGHT_MAP:  highlight mapping</span>
<span class="sd">    :cvar tuple cls.LINE_COMMENT:  tuple with start-/end- comment tags</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">HIGHLIGHT_MAP</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span> <span class="n">type_constant</span>      <span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_func</span>        <span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_param</span>       <span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_struct_full</span> <span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_struct</span>      <span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_enum_full</span>   <span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_env</span>         <span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_member_func</span> <span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_member</span>      <span class="p">,</span> <span class="kc">None</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">]</span>

    <span class="n">LINE_COMMENT</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;# &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span>  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dumped_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translated_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<div class="viewcode-block" id="TranslatorAPI.setParser"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.setParser">[docs]</a>    <span class="k">def</span> <span class="nf">setParser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dumped_names</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="TranslatorAPI.setOptions"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.setOptions">[docs]</a>    <span class="k">def</span> <span class="nf">setOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span></div>

<div class="viewcode-block" id="TranslatorAPI.highlight"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.highlight">[docs]</a>    <span class="k">def</span> <span class="nf">highlight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cont</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;returns *highlighted* text&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">highlight</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">map_text</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HIGHLIGHT_MAP</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cont</span></div>

<div class="viewcode-block" id="TranslatorAPI.get_preamble"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.get_preamble">[docs]</a>    <span class="k">def</span> <span class="nf">get_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">preamble</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span><span class="s2">&quot;src-file: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">rel_fname</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">fname</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">preamble</span><span class="p">:</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">preamble</span> <span class="o">%</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">retVal</span></div>

<div class="viewcode-block" id="TranslatorAPI.get_epilog"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.get_epilog">[docs]</a>    <span class="k">def</span> <span class="nf">get_epilog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">epilog</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This file was automatic generated / don&#39;t edit.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">epilog</span><span class="p">:</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">epilog</span> <span class="o">%</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">retVal</span></div>

<div class="viewcode-block" id="TranslatorAPI.comment"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.comment">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">comment</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cont</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;returns *commented* text&quot;&quot;&quot;</span>

        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">LINE_COMMENT</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cont</span>

        <span class="n">retVal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cont</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">retVal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">line</span> <span class="o">+</span> <span class="n">end</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">retVal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">retVal</span><span class="p">)</span></div>

<div class="viewcode-block" id="TranslatorAPI.write"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">objects</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Write *objects* to stream.</span>

<span class="sd">        Write Unicode-values of the *objects* to :py:attr:``self.options.out``.</span>

<span class="sd">        :param objects: The positional arguments are the objects with the</span>
<span class="sd">            content to write.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span></div>

<div class="viewcode-block" id="TranslatorAPI.write_comment"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.write_comment">[docs]</a>    <span class="k">def</span> <span class="nf">write_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">objects</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Write *objects* as comments to stream.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">(</span><span class="n">cont</span><span class="p">))</span></div>

<div class="viewcode-block" id="TranslatorAPI.eof"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.eof">[docs]</a>    <span class="k">def</span> <span class="nf">eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">eof_newline</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># API</span>
    <span class="c1"># ---</span>

<div class="viewcode-block" id="TranslatorAPI.output_preamble"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.output_preamble">[docs]</a>    <span class="k">def</span> <span class="nf">output_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="TranslatorAPI.output_epilog"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.output_epilog">[docs]</a>    <span class="k">def</span> <span class="nf">output_epilog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="TranslatorAPI.output_DOC"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.output_DOC">[docs]</a>    <span class="k">def</span> <span class="nf">output_DOC</span><span class="p">(</span>
            <span class="bp">self</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.sections</span>
            <span class="p">,</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="TranslatorAPI.output_function_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.output_function_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_function_decl</span><span class="p">(</span>
            <span class="bp">self</span>
            <span class="p">,</span> <span class="n">function</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_name</span>
            <span class="p">,</span> <span class="n">return_type</span>      <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.return_type</span>
            <span class="p">,</span> <span class="n">parameterlist</span>    <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterlist</span>
            <span class="p">,</span> <span class="n">parameterdescs</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterdescs</span>
            <span class="p">,</span> <span class="n">parametertypes</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parametertypes</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.sections</span>
            <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_purpose</span>
            <span class="p">,</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="TranslatorAPI.output_struct_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.output_struct_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_struct_decl</span><span class="p">(</span>
            <span class="bp">self</span>
            <span class="p">,</span> <span class="n">decl_name</span>        <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_name</span>
            <span class="p">,</span> <span class="n">decl_type</span>        <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_type</span>
            <span class="p">,</span> <span class="n">parameterlist</span>    <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterlist</span>
            <span class="p">,</span> <span class="n">parameterdescs</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterdescs</span>
            <span class="p">,</span> <span class="n">parametertypes</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parametertypes</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.sections</span>
            <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_purpose</span>
            <span class="p">,</span> <span class="n">definition</span>       <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.definition</span>
            <span class="p">,</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="TranslatorAPI.output_union_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.output_union_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_union_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_struct_decl</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="TranslatorAPI.output_enum_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.output_enum_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_enum_decl</span><span class="p">(</span>
            <span class="bp">self</span>
            <span class="p">,</span> <span class="n">enum</span>             <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_name</span>
            <span class="p">,</span> <span class="n">parameterlist</span>    <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterlist</span>
            <span class="p">,</span> <span class="n">parameterdescs</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterdescs</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.sections</span>
            <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_purpose</span>
            <span class="p">,</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="TranslatorAPI.output_typedef_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.TranslatorAPI.output_typedef_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_typedef_decl</span><span class="p">(</span>
            <span class="bp">self</span>
            <span class="p">,</span> <span class="n">typedef</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_name</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.sections</span>
            <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_purpose</span>
            <span class="p">,</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="NullTranslator"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.NullTranslator">[docs]</a><span class="k">class</span> <span class="nc">NullTranslator</span><span class="p">(</span><span class="n">TranslatorAPI</span><span class="p">):</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Null translator, translates nothing, just parse.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">HIGHLIGHT_MAP</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">LINE_COMMENT</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="NullTranslator.output_preamble"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.NullTranslator.output_preamble">[docs]</a>    <span class="k">def</span> <span class="nf">output_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span></div>
<div class="viewcode-block" id="NullTranslator.output_epilog"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.NullTranslator.output_epilog">[docs]</a>    <span class="k">def</span> <span class="nf">output_epilog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span></div>
<div class="viewcode-block" id="NullTranslator.output_DOC"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.NullTranslator.output_DOC">[docs]</a>    <span class="k">def</span> <span class="nf">output_DOC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span></div>
<div class="viewcode-block" id="NullTranslator.output_function_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.NullTranslator.output_function_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_function_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span></div>
<div class="viewcode-block" id="NullTranslator.output_struct_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.NullTranslator.output_struct_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_struct_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span></div>
<div class="viewcode-block" id="NullTranslator.output_union_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.NullTranslator.output_union_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_union_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span></div>
<div class="viewcode-block" id="NullTranslator.output_enum_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.NullTranslator.output_enum_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_enum_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span></div>
<div class="viewcode-block" id="NullTranslator.output_typedef_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.NullTranslator.output_typedef_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_typedef_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span></div>
<div class="viewcode-block" id="NullTranslator.eof"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.NullTranslator.eof">[docs]</a>    <span class="k">def</span> <span class="nf">eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ListTranslator"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ListTranslator">[docs]</a><span class="k">class</span> <span class="nc">ListTranslator</span><span class="p">(</span><span class="n">TranslatorAPI</span><span class="p">):</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a list of kernel-doc symbols.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_exported</span><span class="p">,</span> <span class="n">list_internal_types</span>
                 <span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ListTranslator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">list_exported</span>       <span class="o">=</span> <span class="n">list_exported</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_internal_types</span> <span class="o">=</span> <span class="n">list_internal_types</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Parser</span><span class="o">.</span><span class="n">DOC_TYPES</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="ListTranslator.get_type"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ListTranslator.get_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">t</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ListTranslator.output_preamble"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ListTranslator.output_preamble">[docs]</a>    <span class="k">def</span> <span class="nf">output_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="ListTranslator.output_epilog"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ListTranslator.output_epilog">[docs]</a>    <span class="k">def</span> <span class="nf">output_epilog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="ListTranslator.output_DOC"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ListTranslator.output_DOC">[docs]</a>    <span class="k">def</span> <span class="nf">output_DOC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sections</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">sections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;DOC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="p">)</span></div>

<div class="viewcode-block" id="ListTranslator.output_function_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ListTranslator.output_function_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_function_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ListTranslator.output_struct_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ListTranslator.output_struct_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_struct_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;struct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;decl_name&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ListTranslator.output_union_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ListTranslator.output_union_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_union_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;union&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;decl_name&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ListTranslator.output_enum_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ListTranslator.output_enum_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_enum_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;enum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;enum&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ListTranslator.output_typedef_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ListTranslator.output_typedef_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_typedef_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="s2">&quot;typedef&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;typedef&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="ListTranslator.eof"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ListTranslator.eof">[docs]</a>    <span class="k">def</span> <span class="nf">eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_exported</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;list exported symbols&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">exported_symbols</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;exported symbol &#39;</span><span class="si">%(name)s</span><span class="s2">&#39; is undocumented&quot;</span>
                                     <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;undocumented&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[exported </span><span class="si">%-14s</span><span class="s2">] </span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_internal_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;list internal names&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;all&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_internal_types</span>
                        <span class="ow">or</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_internal_types</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">exported_symbols</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[internal </span><span class="si">%-10s</span><span class="s2">] </span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ReSTTranslator"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator">[docs]</a><span class="k">class</span> <span class="nc">ReSTTranslator</span><span class="p">(</span><span class="n">TranslatorAPI</span><span class="p">):</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translate kernel-doc to reST markup.</span>

<span class="sd">    :cvar list HIGHLIGHT_map: Escape common reST (in-line) markups.  Classic</span>
<span class="sd">        kernel-doc comments contain characters and strings like ``*`` or</span>
<span class="sd">        trailing ``_``, which are in-line markups in reST. These special strings</span>
<span class="sd">        has to be masked in reST.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">INDENT</span>       <span class="o">=</span> <span class="s2">&quot;    &quot;</span>
    <span class="n">LINE_COMMENT</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;.. &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">HIGHLIGHT_MAP</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># the regexpr are partial *overlapping*, mind the order!</span>
        <span class="p">(</span>   <span class="n">type_enum_full</span>   <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\ :c:type:`\1 \2 &lt;\2&gt;`\ &quot;</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_struct_full</span> <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\ :c:type:`\1 \2 &lt;\2&gt;`\ &quot;</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_typedef_full</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\ :c:type:`\1 \2 &lt;\2&gt;`\ &quot;</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_union_full</span>  <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\ :c:type:`\1 \2 &lt;\2&gt;`\ &quot;</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_member_func</span> <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\ :c:type:`\1\2() &lt;\1&gt;`\ &quot;</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_member</span>      <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\ :c:type:`\1\2 &lt;\1&gt;`\ &quot;</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_func</span>        <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\ :c:func:`\1`\ &quot;</span><span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_constant</span>    <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\ ``\1``\ &quot;</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_param</span>       <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\ ``\1``\ &quot;</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_env</span>         <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\ ``\1``\ &quot;</span> <span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">type_struct</span>      <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\ :c:type:`struct \1 &lt;\1&gt;`\ &quot;</span><span class="p">)</span>
        <span class="c1"># at least replace escaped %, &amp; and $</span>
        <span class="p">,</span> <span class="p">(</span> <span class="n">esc_type_prefix</span>  <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1&quot;</span><span class="p">)</span>
        <span class="p">,</span> <span class="p">]</span>

    <span class="n">MASK_REST_INLINES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\w)_([\s\*])&quot;</span><span class="p">)</span>  <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1</span><span class="se">\\</span><span class="s2">_\2&quot;</span><span class="p">)</span>  <span class="c1"># trailing underline</span>
        <span class="p">,</span> <span class="p">(</span><span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([\s\*])_(\w)&quot;</span><span class="p">),</span> <span class="sa">r</span><span class="s2">&quot;\1</span><span class="se">\\</span><span class="s2">_\2&quot;</span><span class="p">)</span>  <span class="c1"># leading underline</span>
        <span class="p">,</span> <span class="p">(</span><span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\*)&quot;</span><span class="p">)</span>   <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">\1&quot;</span><span class="p">)</span>  <span class="c1"># emphasis</span>
        <span class="p">,</span> <span class="p">(</span><span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(`)&quot;</span><span class="p">)</span>    <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">\1&quot;</span><span class="p">)</span>  <span class="c1"># interpreted text &amp; inline literals</span>
        <span class="p">,</span> <span class="p">(</span><span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\|)&quot;</span><span class="p">)</span>   <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">\1&quot;</span><span class="p">)</span>  <span class="c1"># substitution references</span>
        <span class="p">,</span> <span class="p">]</span>

    <span class="n">FUNC_PTR</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([^\(]*\(\*)\s*\)\s*\(([^\)]*)\)&quot;</span><span class="p">)</span>
    <span class="n">BITFIELD</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(.*?)\s*(:.*)&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ReSTTranslator.highlight"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.highlight">[docs]</a>    <span class="k">def</span> <span class="nf">highlight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">markup</span> <span class="o">==</span> <span class="s2">&quot;kernel-doc&quot;</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">map_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MASK_REST_INLINES</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">HIGHLIGHT_MAP</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">markup</span> <span class="o">==</span> <span class="s2">&quot;reST&quot;</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">map_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HIGHLIGHT_MAP</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span></div>

<div class="viewcode-block" id="ReSTTranslator.format_block"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.format_block">[docs]</a>    <span class="k">def</span> <span class="nf">format_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;format the content (string)&quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">markup</span> <span class="o">==</span> <span class="s2">&quot;kernel-doc&quot;</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">markup</span> <span class="o">==</span> <span class="s2">&quot;reST&quot;</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span> <span class="n">l</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReSTTranslator.write_anchor"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.write_anchor">[docs]</a>    <span class="k">def</span> <span class="nf">write_anchor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refname</span><span class="p">):</span>
        <span class="n">ID</span> <span class="o">=</span> <span class="n">refname</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">id_prefix</span><span class="p">:</span>
            <span class="n">ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">id_prefix</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">ID</span>
        <span class="n">ID</span> <span class="o">=</span> <span class="n">normalize_id</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. _`</span><span class="si">%s</span><span class="s2">`:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ID</span><span class="p">)</span></div>

    <span class="n">HEADER_TAGS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;#&quot;</span>   <span class="c1"># level 0 / part with overline</span>
        <span class="s2">&quot;=&quot;</span>   <span class="c1"># level 1 / chapter with overline</span>
        <span class="s2">&quot;=&quot;</span>   <span class="c1"># level 2 / sec</span>
        <span class="s2">&quot;-&quot;</span>   <span class="c1"># level 3 / subsec</span>
        <span class="s2">&quot;-&quot;</span>   <span class="c1"># level 4 / subsubsec</span>
        <span class="s1">&#39;&quot;&#39;</span> <span class="p">)</span> <span class="c1"># level 5 / para</span>

<div class="viewcode-block" id="ReSTTranslator.write_header"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.write_header">[docs]</a>    <span class="k">def</span> <span class="nf">write_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">sec_level</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="n">sectag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HEADER_TAGS</span><span class="p">[</span><span class="n">sec_level</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sec_level</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sectag</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">header</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sectag</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReSTTranslator.write_section"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.write_section">[docs]</a>    <span class="k">def</span> <span class="nf">write_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">sec_level</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">no_header</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ID</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_anchor</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">sec_level</span><span class="o">=</span><span class="n">sec_level</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">header</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;example&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. code-block:: c</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_block</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">content</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReSTTranslator.write_definition"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.write_definition">[docs]</a>    <span class="k">def</span> <span class="nf">write_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">term</span>  <span class="o">=</span> <span class="n">normalize_ws</span><span class="p">(</span><span class="n">term</span><span class="p">)</span> <span class="c1"># term has to be a &quot;one-liner&quot;</span>
        <span class="n">term</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">definition</span> <span class="o">!=</span> <span class="n">Parser</span><span class="o">.</span><span class="n">undescribed</span><span class="p">:</span>
            <span class="n">definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_block</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span>
            <span class="n">definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReSTTranslator.write_func_param"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.write_func_param">[docs]</a>    <span class="k">def</span> <span class="nf">write_func_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">descr</span><span class="p">):</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\*&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">descr</span> <span class="o">!=</span> <span class="n">Parser</span><span class="o">.</span><span class="n">undescribed</span><span class="p">:</span>
            <span class="n">descr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_block</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span>
            <span class="n">descr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">descr</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReSTTranslator.output_preamble"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.output_preamble">[docs]</a>    <span class="k">def</span> <span class="nf">output_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">mode_line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_comment</span><span class="p">(</span>
                <span class="s2">&quot;-*- coding: </span><span class="si">%s</span><span class="s2">; mode: rst -*-</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">out</span><span class="p">,</span> <span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="n">preamble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_preamble</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">preamble</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">preamble</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">top_title</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_anchor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">top_title</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">top_title</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">top_link</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">top_link</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReSTTranslator.output_epilog"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.output_epilog">[docs]</a>    <span class="k">def</span> <span class="nf">output_epilog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">epilog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_epilog</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">epilog</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">epilog</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReSTTranslator.output_DOC"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.output_DOC">[docs]</a>    <span class="k">def</span> <span class="nf">output_DOC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sections</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span>
        <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">sections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_section</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">sec_level</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="n">header</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReSTTranslator.output_function_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.output_function_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_function_decl</span><span class="p">(</span>
            <span class="bp">self</span>
            <span class="p">,</span> <span class="n">function</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_name</span>
            <span class="p">,</span> <span class="n">return_type</span>      <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.return_type</span>
            <span class="p">,</span> <span class="n">parameterlist</span>    <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterlist</span>
            <span class="p">,</span> <span class="n">parameterdescs</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterdescs</span>
            <span class="p">,</span> <span class="n">parametertypes</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parametertypes</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.sections</span>
            <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_purpose</span>
            <span class="p">,</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_anchor</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">sec_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">man_sect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. kernel-doc-man:: </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">man_sect</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># write function definition</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. c:function:: &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_type</span> <span class="ow">and</span> <span class="n">return_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">return_type</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">return_type</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">)</span>

        <span class="n">p_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">p_name</span> <span class="ow">in</span> <span class="n">parameterlist</span><span class="p">:</span>
            <span class="n">p_type</span> <span class="o">=</span> <span class="n">parametertypes</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">FUNC_PTR</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p_type</span><span class="p">):</span>
                <span class="c1"># pointer to function</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">)(</span><span class="si">%s</span><span class="s2">)&quot;</span>
                              <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FUNC_PTR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FUNC_PTR</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">p_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
                <span class="c1"># pointer</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p_type</span><span class="p">,</span> <span class="n">p_name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p_type</span><span class="p">,</span> <span class="n">p_name</span><span class="p">))</span>

        <span class="n">p_line</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">p_line</span><span class="p">,</span> <span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># purpose</span>

        <span class="k">if</span> <span class="n">purpose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">purpose</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># parameter descriptions</span>

        <span class="k">for</span> <span class="n">p_name</span> <span class="ow">in</span> <span class="n">parameterlist</span><span class="p">:</span>

            <span class="n">p_type</span> <span class="o">=</span> <span class="n">parametertypes</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span>
            <span class="n">p_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">p_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">p_name</span> <span class="o">!=</span> <span class="s2">&quot;...&quot;</span> <span class="ow">and</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">p_name</span><span class="p">:</span>
                <span class="c1"># @foo.bar sub-descriptions are printed below, ignore them here</span>
                <span class="k">continue</span>

            <span class="n">p_desc</span> <span class="o">=</span> <span class="n">parameterdescs</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span>

            <span class="n">param</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">FUNC_PTR</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p_type</span><span class="p">):</span>
                <span class="c1"># pointer to function</span>
                <span class="n">param</span> <span class="o">=</span> <span class="s2">&quot;:param </span><span class="si">%s%s</span><span class="s2">)(</span><span class="si">%s</span><span class="s2">):&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FUNC_PTR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FUNC_PTR</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">p_type</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
                <span class="c1"># pointer &amp; pointer to pointer</span>
                <span class="n">param</span> <span class="o">=</span> <span class="s2">&quot;:param </span><span class="si">%s%s</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p_type</span><span class="p">,</span> <span class="n">p_name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">p_name</span> <span class="o">==</span> <span class="s2">&quot;...&quot;</span><span class="p">:</span>
                <span class="n">param</span> <span class="o">=</span> <span class="s2">&quot;:param ellipsis ellipsis:&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">param</span> <span class="o">=</span> <span class="s2">&quot;:param </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p_type</span><span class="p">,</span> <span class="n">p_name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">parameterdescs</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">p_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">write_func_param</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">p_desc</span><span class="p">)</span>

            <span class="c1"># print all the @foo.bar sub-descriptions</span>
            <span class="n">sub_descr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parameterdescs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">p_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">_p_name</span> <span class="ow">in</span> <span class="n">sub_descr</span><span class="p">:</span>
                <span class="n">p_desc</span> <span class="o">=</span> <span class="n">parameterdescs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_p_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="c1"># do not print undescribed sub-descriptions</span>
                <span class="k">if</span> <span class="n">p_desc</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">undescribed</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">parameterdescs</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">_p_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_definition</span><span class="p">(</span><span class="n">_p_name</span><span class="p">,</span> <span class="n">p_desc</span><span class="p">)</span>

        <span class="c1"># sections</span>

        <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">sections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">sections</span><span class="o">.</span><span class="n">offsets</span><span class="p">[</span><span class="n">header</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_section</span><span class="p">(</span>
                <span class="n">header</span>
                <span class="p">,</span> <span class="n">content</span>
                <span class="p">,</span> <span class="n">sec_level</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="p">,</span> <span class="n">ID</span> <span class="o">=</span> <span class="n">function</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">header</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReSTTranslator.output_struct_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.output_struct_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_struct_decl</span><span class="p">(</span>
            <span class="bp">self</span>
            <span class="p">,</span> <span class="n">decl_name</span>        <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_name</span>
            <span class="p">,</span> <span class="n">decl_type</span>        <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_type</span>
            <span class="p">,</span> <span class="n">parameterlist</span>    <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterlist</span>
            <span class="p">,</span> <span class="n">parameterdescs</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterdescs</span>
            <span class="p">,</span> <span class="n">parametertypes</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parametertypes</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.sections</span>
            <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_purpose</span>
            <span class="p">,</span> <span class="n">definition</span>       <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.definition</span>
            <span class="p">,</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_anchor</span><span class="p">(</span><span class="n">decl_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">decl_type</span><span class="p">,</span> <span class="n">decl_name</span><span class="p">),</span> <span class="n">sec_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">man_sect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. kernel-doc-man:: </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">decl_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">man_sect</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># write struct definition</span>
        <span class="c1"># see https://github.com/sphinx-doc/sphinx/issues/2713</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. c:type:: struct </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">decl_name</span><span class="p">)</span>

        <span class="c1"># purpose</span>

        <span class="k">if</span> <span class="n">purpose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">purpose</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># definition</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_anchor</span><span class="p">(</span><span class="n">decl_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">Parser</span><span class="o">.</span><span class="n">section_def</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="n">Parser</span><span class="o">.</span><span class="n">section_def</span><span class="p">,</span> <span class="n">sec_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. code-block:: c</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="n">decl_type</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">decl_name</span><span class="p">,</span> <span class="s2">&quot; {</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">definition</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(([{;]))&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1\n&quot;</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">enum</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">definition</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">clause</span> <span class="o">=</span> <span class="n">normalize_ws</span><span class="p">(</span><span class="n">clause</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">clause</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">clause</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;}&quot;</span> <span class="ow">and</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">MACRO</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">clause</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="n">clause</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">enum</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">clause</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="n">normalize_ws</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;}&quot;</span> <span class="ow">and</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span> <span class="o">*</span> <span class="n">level</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span> <span class="o">*</span> <span class="n">level</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="s1">&#39;,</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span> <span class="o">*</span> <span class="n">level</span><span class="p">,</span> <span class="n">clause</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clause</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;{&quot;</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">enum</span> <span class="o">=</span> <span class="n">clause</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;enum&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># member description</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_anchor</span><span class="p">(</span><span class="n">decl_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">Parser</span><span class="o">.</span><span class="n">section_members</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="n">Parser</span><span class="o">.</span><span class="n">section_members</span><span class="p">,</span> <span class="n">sec_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p_name</span> <span class="ow">in</span> <span class="n">parameterlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">MACRO</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p_name</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">p_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">p_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">p_name</span><span class="p">:</span>
                <span class="c1"># @foo.bar sub-descriptions are printed below, ignore them here</span>
                <span class="k">continue</span>

            <span class="n">p_desc</span> <span class="o">=</span> <span class="n">parameterdescs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">p_desc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">parameterdescs</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">p_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_definition</span><span class="p">(</span><span class="n">p_name</span><span class="p">,</span> <span class="n">p_desc</span><span class="p">)</span>

            <span class="c1"># print all the @foo.bar sub-descriptions</span>
            <span class="n">sub_descr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parameterdescs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">p_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">_p_name</span> <span class="ow">in</span> <span class="n">sub_descr</span><span class="p">:</span>
                <span class="n">p_desc</span> <span class="o">=</span> <span class="n">parameterdescs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_p_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="c1"># do not print undescribed sub-descriptions</span>
                <span class="k">if</span> <span class="n">p_desc</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">undescribed</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">parameterdescs</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">_p_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_definition</span><span class="p">(</span><span class="n">_p_name</span><span class="p">,</span> <span class="n">p_desc</span><span class="p">)</span>

        <span class="c1"># sections</span>

        <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">sections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">sections</span><span class="o">.</span><span class="n">offsets</span><span class="p">[</span><span class="n">header</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_section</span><span class="p">(</span>
                <span class="n">header</span>
                <span class="p">,</span> <span class="n">content</span>
                <span class="p">,</span> <span class="n">sec_level</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="p">,</span> <span class="n">ID</span> <span class="o">=</span> <span class="n">decl_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">header</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReSTTranslator.output_enum_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.output_enum_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_enum_decl</span><span class="p">(</span>
            <span class="bp">self</span>
            <span class="p">,</span> <span class="n">enum</span>             <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_name</span>
            <span class="p">,</span> <span class="n">parameterlist</span>    <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterlist</span>
            <span class="p">,</span> <span class="n">parameterdescs</span>   <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.parameterdescs</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.sections</span>
            <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_purpose</span>
            <span class="p">,</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_anchor</span><span class="p">(</span><span class="n">enum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="s2">&quot;enum </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">enum</span><span class="p">,</span> <span class="n">sec_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">man_sect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. kernel-doc-man:: </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">enum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">man_sect</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># write union definition</span>
        <span class="c1"># see https://github.com/sphinx-doc/sphinx/issues/2713</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. c:type:: enum </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">enum</span><span class="p">)</span>

        <span class="c1"># purpose</span>

        <span class="k">if</span> <span class="n">purpose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">purpose</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># definition</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_anchor</span><span class="p">(</span><span class="n">enum</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">Parser</span><span class="o">.</span><span class="n">section_def</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="n">Parser</span><span class="o">.</span><span class="n">section_def</span><span class="p">,</span> <span class="n">sec_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. code-block:: c</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="s2">&quot;enum &quot;</span><span class="p">,</span> <span class="n">enum</span><span class="p">,</span> <span class="s2">&quot; {&quot;</span><span class="p">)</span>

        <span class="n">e_list</span> <span class="o">=</span> <span class="n">parameterlist</span><span class="p">[:]</span>
        <span class="k">while</span> <span class="n">e_list</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">e_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">MACRO</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">e_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="s2">&quot;};</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># constants description</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_anchor</span><span class="p">(</span><span class="n">enum</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">Parser</span><span class="o">.</span><span class="n">section_constants</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="n">Parser</span><span class="o">.</span><span class="n">section_constants</span><span class="p">,</span> <span class="n">sec_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p_name</span> <span class="ow">in</span> <span class="n">parameterlist</span><span class="p">:</span>
            <span class="n">p_desc</span> <span class="o">=</span> <span class="n">parameterdescs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">parameterdescs</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">p_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">p_desc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_definition</span><span class="p">(</span><span class="n">p_name</span><span class="p">,</span> <span class="n">p_desc</span><span class="p">)</span>

        <span class="c1"># sections</span>

        <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">sections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">sections</span><span class="o">.</span><span class="n">offsets</span><span class="p">[</span><span class="n">header</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_section</span><span class="p">(</span>
                <span class="n">header</span>
                <span class="p">,</span> <span class="n">content</span> <span class="ow">or</span> <span class="s2">&quot;???&quot;</span>
                <span class="p">,</span> <span class="n">sec_level</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="p">,</span> <span class="n">ID</span> <span class="o">=</span> <span class="n">enum</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">header</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReSTTranslator.output_typedef_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ReSTTranslator.output_typedef_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_typedef_decl</span><span class="p">(</span>
            <span class="bp">self</span>
            <span class="p">,</span> <span class="n">typedef</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_name</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.sections</span>
            <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># ctx.decl_purpose</span>
            <span class="p">,</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_anchor</span><span class="p">(</span><span class="n">typedef</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_header</span><span class="p">(</span><span class="s2">&quot;typedef </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">typedef</span><span class="p">,</span> <span class="n">sec_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">man_sect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. kernel-doc-man:: </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">typedef</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">man_sect</span><span class="p">)</span> <span class="p">)</span>

        <span class="c1"># write typdef definition</span>
        <span class="c1"># see https://github.com/sphinx-doc/sphinx/issues/2713</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">.. c:type:: typedef </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">typedef</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">purpose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INDENT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="n">purpose</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">sections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">sections</span><span class="o">.</span><span class="n">offsets</span><span class="p">[</span><span class="n">header</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_section</span><span class="p">(</span>
                <span class="n">header</span>
                <span class="p">,</span> <span class="n">content</span> <span class="ow">or</span> <span class="s2">&quot;???&quot;</span>
                <span class="p">,</span> <span class="n">sec_level</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="p">,</span> <span class="n">ID</span> <span class="o">=</span> <span class="n">typedef</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">header</span><span class="p">)</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParseOptions"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ParseOptions">[docs]</a><span class="k">class</span> <span class="nc">ParseOptions</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

    <span class="n">PARSE_OPTION_RE</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^/\*+\s*parse-</span><span class="si">%s</span><span class="s2">:\s*([a-zA-Z0-9_-]*?)\s*\*/+\s*$&quot;</span>
    <span class="n">PARSE_OPTIONS</span>   <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;highlight&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;on&quot;</span><span class="p">,</span><span class="s2">&quot;off&quot;</span><span class="p">],</span> <span class="s2">&quot;setOnOff&quot;</span><span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span><span class="s2">&quot;INSPECT&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;on&quot;</span><span class="p">,</span><span class="s2">&quot;off&quot;</span><span class="p">],</span> <span class="s2">&quot;setINSPECT&quot;</span><span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span><span class="s2">&quot;markup&quot;</span><span class="p">,</span>  <span class="p">[</span><span class="s2">&quot;reST&quot;</span><span class="p">,</span> <span class="s2">&quot;kernel-doc&quot;</span><span class="p">],</span> <span class="s2">&quot;setVal&quot;</span><span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span><span class="s2">&quot;SNIP&quot;</span><span class="p">,</span>    <span class="p">[],</span> <span class="s2">&quot;setVal&quot;</span><span class="p">)</span>
        <span class="p">,</span> <span class="p">(</span><span class="s2">&quot;SNAP&quot;</span><span class="p">,</span>    <span class="p">[],</span> <span class="s2">&quot;snap&quot;</span><span class="p">)</span>
        <span class="p">,</span> <span class="p">]</span>

<div class="viewcode-block" id="ParseOptions.dumpOptions"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ParseOptions.dumpOptions">[docs]</a>    <span class="k">def</span> <span class="nf">dumpOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># dumps options which are variable from parsing source-code</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">highlight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span>
            <span class="p">,</span> <span class="n">markup</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markup</span> <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id_prefix</span>      <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># A prefix for generated IDs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span>            <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># File descriptor for output.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eof_newline</span>    <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># write newline on end of file</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">src_tree</span>       <span class="o">=</span> <span class="n">SRCTREE</span> <span class="c1"># root of the kernel sources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel_fname</span>      <span class="o">=</span> <span class="s2">&quot;&quot;</span>      <span class="c1"># pathname relative to src_tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span>          <span class="o">=</span> <span class="s2">&quot;&quot;</span>      <span class="c1"># absolute pathname</span>

        <span class="c1"># self.encoding: the input encoding (encoding of the parsed source</span>
        <span class="c1"># file), the output encoding could be seek from the file-descriptor at</span>
        <span class="c1"># self.out.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span>       <span class="o">=</span> <span class="s2">&quot;utf-8&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab_width</span>      <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># tab-stops every n chars</span>

        <span class="c1"># control which content to print</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">use_names</span>     <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># positive list of names to print / empty list means &quot;print all&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_names</span>    <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># negative list of names (not to print)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_all_docs</span>  <span class="o">=</span> <span class="kc">False</span> <span class="c1"># True/False print all &quot;DOC:&quot; sections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_header</span>     <span class="o">=</span> <span class="kc">False</span> <span class="c1"># skip section header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_missing</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># report missing names as errors / else warning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_warn</span>  <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># more warn messages</span>

        <span class="c1"># self.gather_context: [True/False] Scan additional context from the</span>
        <span class="c1"># parsed source. E.g.: The list of exported symbols is a part of the</span>
        <span class="c1"># parser&#39;s context. If the context of exported symbols is needed, we</span>
        <span class="c1"># have to parse twice. First to find exported symbols, store them in the</span>
        <span class="c1"># context and a second once for *normal* parsing within this modified</span>
        <span class="c1"># *context*.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gather_context</span>    <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># epilog / preamble</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">skip_preamble</span>  <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_epilog</span>    <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_line</span>      <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># write mode-line in the very first line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_title</span>      <span class="o">=</span> <span class="s2">&quot;&quot;</span>    <span class="c1"># write a title on top of the preamble</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_link</span>       <span class="o">=</span> <span class="s2">&quot;&quot;</span>    <span class="c1"># if top_title, add link to the *top* of the preamble</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preamble</span>       <span class="o">=</span> <span class="s2">&quot;&quot;</span>    <span class="c1"># additional text placed into the preamble</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epilog</span>         <span class="o">=</span> <span class="s2">&quot;&quot;</span>    <span class="c1"># text placed into the epilog</span>

        <span class="c1"># default&#39;s of filtered PARSE_OPTIONS</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">opt_filters</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markup</span>         <span class="o">=</span> <span class="s2">&quot;reST&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight</span>      <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># switch highlighting on/off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">man_sect</span>       <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># insert &quot;.. kernel-doc-man:&quot; directive, section no self.man_sect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_filters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PARSE_OPTIONS</span><span class="p">)</span>

        <span class="c1"># SNIP / SNAP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SNIP</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ParseOptions</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># absolute and relativ filename</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_tree</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">):</span>
            <span class="c1"># if SCRTREE and abspath fname is given, determine relativ pathname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rel_fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_tree</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_tree</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">):</span>
            <span class="c1"># if SCRTREE and relative fname is given, drop fname and set rel_fname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rel_fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_tree</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_fname</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_fname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;no relative pathname given / no SRCTREE: &quot;</span>
                     <span class="s2">&quot; features based on these settings might not work&quot;</span>
                     <span class="s2">&quot; as expected!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">:</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;no source file given!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>

<div class="viewcode-block" id="ParseOptions.set_defaults"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ParseOptions.set_defaults">[docs]</a>    <span class="k">def</span> <span class="nf">set_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># default top title and top link</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_title</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_title</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_title</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_title</span> <span class="o">%</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_link</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_fname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">top_link</span>  <span class="o">=</span> <span class="n">GIT_REF</span> <span class="o">%</span> <span class="bp">self</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;missing SRCTREE, can&#39;t set *top_link* option&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_link</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_link</span> <span class="o">%</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="ParseOptions.add_filters"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ParseOptions.add_filters">[docs]</a>    <span class="k">def</span> <span class="nf">add_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse_options</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">setINSPECT</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span> <span class="c1"># pylint: disable=W0613</span>
            <span class="k">global</span> <span class="n">INSPECT</span>         <span class="c1"># pylint: disable=W0603</span>
            <span class="n">INSPECT</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;on&quot;</span><span class="p">)</span>

        <span class="n">_actions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">setOnOff</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;on&quot;</span><span class="p">)</span> <span class="p">)</span>
            <span class="p">,</span> <span class="n">setVal</span>     <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="p">)</span>
            <span class="p">,</span> <span class="n">snap</span>       <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="p">(</span> <span class="s2">&quot;SNIP&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span>
            <span class="p">,</span> <span class="n">setINSPECT</span> <span class="o">=</span> <span class="n">setINSPECT</span>
            <span class="p">,</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">option</span><span class="p">,</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">parse_options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt_filters</span><span class="p">[</span><span class="n">option</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">RE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PARSE_OPTION_RE</span> <span class="o">%</span> <span class="n">option</span><span class="p">),</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">_actions</span><span class="p">[</span><span class="n">action</span><span class="p">])</span></div>

<div class="viewcode-block" id="ParseOptions.filter_opt"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ParseOptions.filter_opt">[docs]</a>    <span class="k">def</span> <span class="nf">filter_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">regexpr</span><span class="p">,</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">regexpr</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="n">line</span>  <span class="o">=</span> <span class="kc">None</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">regexpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">val_list</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val_list</span><span class="p">:</span>
                    <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;unknown parse-</span><span class="si">%(name)s</span><span class="s2"> value: &#39;</span><span class="si">%(value)s</span><span class="s2">&#39;&quot;</span>
                               <span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">opt_val</span> <span class="o">=</span> <span class="n">action</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">opt_val</span>  <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">opt_val</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>  <span class="o">=</span> <span class="n">value</span>
                    <span class="n">parser</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;set parse-option: </span><span class="si">%(name)s</span><span class="s2"> = &#39;</span><span class="si">%(value)s</span><span class="s2">&#39;&quot;</span>
                        <span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">line</span></div></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ParserContext"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ParserContext">[docs]</a><span class="k">class</span> <span class="nc">ParserContext</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="ParserContext.dumpCtx"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ParserContext.dumpCtx">[docs]</a>    <span class="k">def</span> <span class="nf">dumpCtx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># dumps options which are variable from parsing source-code</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">decl_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decl_offset</span> <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_no</span>           <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contents</span>          <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section</span>           <span class="o">=</span> <span class="n">Parser</span><span class="o">.</span><span class="n">section_default</span>

        <span class="c1"># self.sections: ordered dictionary (list) of sections as they appear in</span>
        <span class="c1"># the source. The sections are set by Parser.dump_section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span>          <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sectcheck</span>         <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prototype</span>         <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_identifier</span>   <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># self.parameterlist: ordered list of the parameters as they appear in</span>
        <span class="c1"># the source. The parameter-list is set by Parser.push_parameter and</span>
        <span class="c1"># Parser.dump_enum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterlist</span>     <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># self.parametertypes: dictionary of &lt;parameter-name&gt;:&lt;type&gt;</span>
        <span class="c1"># key/values of the parameters. Set by Parser.push_parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parametertypes</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># self.parameterdescs: dictionary of &lt;&#39;@parameter&#39;&gt;:&lt;description&gt;</span>
        <span class="c1"># key/values of the parameters. Set by Parser.dump_section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterdescs</span>    <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c1"># self.constants: dictionary of &lt;&#39;%CONST&#39;&gt;:&lt;description&gt;</span>
        <span class="c1"># key/values. Set by Parser.dump_section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constants</span>         <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">decl_name</span>         <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decl_type</span>         <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># [struct|union|enum|typedef|function]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decl_purpose</span>      <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">return_type</span>       <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1">#self.struct_actual     = &quot;&quot;</span>

        <span class="c1"># Additional context from the parsed source</span>

        <span class="c1"># self.exported: list of exported symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exported_symbols</span>  <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># self.mod_xxx: Module informations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mod_authors</span>       <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mod_descr</span>         <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mod_license</span>       <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># SNIP / SNAP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snippets</span>  <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>

        <span class="c1"># the place, where type dumps are stored</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_storage</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># memo line numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decl_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">offsets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameterdescs</span><span class="o">.</span><span class="n">offsets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ParserContext</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="ParserContext.new"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ParserContext.new">[docs]</a>    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
            <span class="n">line_no</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_no</span>
            <span class="p">,</span> <span class="n">exported_symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exported_symbols</span>
            <span class="p">,</span> <span class="n">snippets</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">snippets</span>
            <span class="p">,</span> <span class="n">dump_storage</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_storage</span> <span class="p">)</span></div></div>


<div class="viewcode-block" id="ParserBuggy"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.ParserBuggy">[docs]</a><span class="k">class</span> <span class="nc">ParserBuggy</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Exception raised when the parser implementation seems buggy.</span>

<span class="sd">    The parser implementation perform some integrity tests at runtime.  This</span>
<span class="sd">    exception type mainly exists to improve the regular expressions which are</span>
<span class="sd">    used to parse and analyze the kernels source code.</span>

<span class="sd">    In the exception message the last position the parser parsed is stored, this</span>
<span class="sd">    position may, but does not need to be related with the exception (it is only</span>
<span class="sd">    an additional information which might help).</span>

<span class="sd">    Under normal circumstances, exceptions of this type should never arise,</span>
<span class="sd">    unless the implementation of the parser is buggy.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parserObj</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>

        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;last parse position </span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
                   <span class="o">%</span> <span class="p">(</span><span class="n">parserObj</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span><span class="p">,</span> <span class="n">parserObj</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
                   <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParserBuggy</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parserObj</span> <span class="o">=</span> <span class="n">parserObj</span></div>

<span class="c1"># ------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Parser"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser">[docs]</a><span class="k">class</span> <span class="nc">Parser</span><span class="p">(</span><span class="n">SimpleLog</span><span class="p">):</span>
<span class="c1"># ------------------------------------------------------------------------------</span>

    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    kernel-doc comments parser</span>

<span class="sd">    States:</span>

<span class="sd">    * 0 - normal code</span>
<span class="sd">    * 1 - looking for function name</span>
<span class="sd">    * 2 - scanning field start.</span>
<span class="sd">    * 3 - scanning prototype.</span>
<span class="sd">    * 4 - documentation block</span>
<span class="sd">    * 5 - gathering documentation outside main block (see Split Doc State)</span>

<span class="sd">    Split Doc States:</span>

<span class="sd">    * 0 - Invalid (Before start or after finish)</span>
<span class="sd">    * 1 - Is started (the /\\*\\* was found inside a struct)</span>
<span class="sd">    * 2 - The @parameter header was found, start accepting multi paragraph text.</span>
<span class="sd">    * 3 - Finished (the \\*/ was found)</span>
<span class="sd">    * 4 - Error: Comment without header was found. Spit a error as it&#39;s not</span>
<span class="sd">          proper kernel-doc and ignore the rest.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">LOG_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(fname)s</span><span class="s2">:</span><span class="si">%(line_no)s</span><span class="s2">: :</span><span class="si">%(logclass)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="c1"># DOC_TYPES: types of documentation gathered by the parser</span>
    <span class="n">DOC_TYPES</span>      <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DOC&quot;</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span> <span class="s2">&quot;struct&quot;</span><span class="p">,</span> <span class="s2">&quot;union&quot;</span><span class="p">,</span> <span class="s2">&quot;enum&quot;</span><span class="p">,</span> <span class="s2">&quot;typedef&quot;</span><span class="p">]</span>

    <span class="n">undescribed</span>      <span class="o">=</span> <span class="s2">&quot;*undescribed*&quot;</span>

    <span class="n">section_descr</span>     <span class="o">=</span> <span class="s2">&quot;Description&quot;</span>
    <span class="n">section_def</span>       <span class="o">=</span> <span class="s2">&quot;Definition&quot;</span>
    <span class="n">section_members</span>   <span class="o">=</span> <span class="s2">&quot;Members&quot;</span>
    <span class="n">section_constants</span> <span class="o">=</span> <span class="s2">&quot;Constants&quot;</span>
    <span class="n">section_intro</span>     <span class="o">=</span> <span class="s2">&quot;Introduction&quot;</span>
    <span class="n">section_context</span>   <span class="o">=</span> <span class="s2">&quot;Context&quot;</span>
    <span class="n">section_return</span>    <span class="o">=</span> <span class="s2">&quot;Return&quot;</span>
    <span class="n">section_default</span>   <span class="o">=</span> <span class="n">section_descr</span>

    <span class="n">special_sections</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">section_descr</span>
                          <span class="p">,</span> <span class="n">section_def</span>
                          <span class="p">,</span> <span class="n">section_members</span>
                          <span class="p">,</span> <span class="n">section_constants</span>
                          <span class="p">,</span> <span class="n">section_context</span>
                          <span class="p">,</span> <span class="n">section_return</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">translator</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Parser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># raw data akku</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span>    <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># flags:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">split_doc_state</span>   <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_doc_sect</span>       <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_purpose</span>        <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brcount</span>           <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span>          <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span>            <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anon_struct_union</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">options</span>    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span>        <span class="o">=</span> <span class="n">ParserContext</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setTranslator</span><span class="p">(</span><span class="n">translator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setOptions</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>

<div class="viewcode-block" id="Parser.setTranslator"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.setTranslator">[docs]</a>    <span class="k">def</span> <span class="nf">setTranslator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">translator</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translator</span> <span class="o">=</span> <span class="n">translator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">setParser</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">setOptions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.setOptions"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.setOptions">[docs]</a>    <span class="k">def</span> <span class="nf">setOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">setOptions</span><span class="p">(</span><span class="n">options</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.reset_state"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.reset_state">[docs]</a>    <span class="k">def</span> <span class="nf">reset_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span>             <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">split_doc_state</span>   <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_doc_sect</span>       <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_purpose</span>        <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brcount</span>           <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anon_struct_union</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="c1"># ------------------------------------------------------------</span>
    <span class="c1"># Log</span>
    <span class="c1"># ------------------------------------------------------------</span>

<div class="viewcode-block" id="Parser.error"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">_line_no</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">):</span>
        <span class="n">replace</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">fname</span>
        <span class="n">replace</span><span class="p">[</span><span class="s2">&quot;line_no&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line_no&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Parser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.warn"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.warn">[docs]</a>    <span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">_line_no</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">):</span>
        <span class="n">replace</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">fname</span>
        <span class="n">replace</span><span class="p">[</span><span class="s2">&quot;line_no&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line_no&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Parser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.info"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">_line_no</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">):</span>
        <span class="n">replace</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">fname</span>
        <span class="n">replace</span><span class="p">[</span><span class="s2">&quot;line_no&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line_no&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Parser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.debug"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.debug">[docs]</a>    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">_line_no</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">):</span>
        <span class="n">replace</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">fname</span>
        <span class="n">replace</span><span class="p">[</span><span class="s2">&quot;line_no&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">replace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;line_no&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Parser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">replace</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------</span>
    <span class="c1"># state parser</span>
    <span class="c1"># ------------------------------------------------------------</span>

<div class="viewcode-block" id="Parser.gather_context"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.gather_context">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">gather_context</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Scan source about context informations.</span>

<span class="sd">        Scans *whole* source (e.g. :py:attr:`Parser.rawdata`) about data relevant</span>
<span class="sd">        for the context (e.g. exported symbols).</span>

<span class="sd">        Names of exported symbols gathered in :py:attr:`ParserContext.exported`.</span>
<span class="sd">        The list contains names (symbols) which are exported using the</span>
<span class="sd">        EXPORT_SYMBOL macro.</span>

<span class="sd">        * ``EXPORT_SYMBOL(&lt;name&gt;)``</span>
<span class="sd">        * ``EXPORT_SYMBOL_GPL(&lt;name&gt;)``</span>
<span class="sd">        * ``EXPORT_SYMBOL_GPL_FUTURE(&lt;name&gt;)``)</span>

<span class="sd">        .. hint::</span>

<span class="sd">          A exported symbol does not necessarily have a corresponding source code</span>
<span class="sd">          comment with a documentation.</span>

<span class="sd">        Module information comes from the ``MODULE_xxx`` macros.  Module</span>
<span class="sd">        informations are gathered in ``ParserContext.module_xxx``:</span>

<span class="sd">        * ``MODULE_AUTHOR(&quot;...&quot;)``: Author entries are collected in a list in</span>
<span class="sd">          :py:attr:`ParserContext.mod_authors`</span>

<span class="sd">        * ``MODULE_DESCRIPTION(&quot;...&quot;)``: A concatenated string in</span>
<span class="sd">          :py:attr:`ParserContext.mod_descr`</span>

<span class="sd">        * ``MODULE_LICENSE(&quot;...&quot;)``: String with comma separated licenses in</span>
<span class="sd">          :py:attr:`ParserContext.mod_license`.</span>

<span class="sd">        .. hint::</span>

<span class="sd">           While parsing header files, about kernel-doc, you will not find the</span>
<span class="sd">           ``MODULE_xxx`` macros, because they are commonly used in the &quot;.c&quot;</span>
<span class="sd">           files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;gather_context() regExp: </span><span class="si">%(pattern)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">EXPORTED_SYMBOLS</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">EXPORTED_SYMBOLS</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;exported symbol: </span><span class="si">%(name)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">exported_symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;gather_context() regExp: </span><span class="si">%(pattern)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">MODULE_INFO</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">MODULE_INFO</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
            <span class="n">info_type</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">content</span>   <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">info_type</span> <span class="o">==</span> <span class="s2">&quot;AUTHOR&quot;</span><span class="p">:</span>
                <span class="n">ctx</span><span class="o">.</span><span class="n">mod_authors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">info_type</span> <span class="o">==</span> <span class="s2">&quot;DESCRIPTION&quot;</span><span class="p">:</span>
                <span class="n">ctx</span><span class="o">.</span><span class="n">mod_descr</span>   <span class="o">+=</span> <span class="n">content</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
            <span class="k">elif</span> <span class="n">info_type</span> <span class="o">==</span> <span class="s2">&quot;LICENSE&quot;</span><span class="p">:</span>
                <span class="n">ctx</span><span class="o">.</span><span class="n">mod_license</span> <span class="o">+=</span> <span class="n">content</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>

        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;mod_authors: </span><span class="si">%(x)s</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="n">x</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">mod_authors</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;mod_descr: </span><span class="si">%(x)s</span><span class="s2">&quot;</span><span class="p">,</span>    <span class="n">x</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">mod_descr</span><span class="p">)</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;mod_license : </span><span class="si">%(x)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">mod_license</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.parse"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="c1"># start parsing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_preamble</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">src</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">openTextFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">srcFile</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">srcFile</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_epilog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">eof</span><span class="p">()</span></div>

<div class="viewcode-block" id="Parser.parse_dump_storage"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.parse_dump_storage">[docs]</a>    <span class="k">def</span> <span class="nf">parse_dump_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">translator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setOptions</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">translator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTranslator</span><span class="p">(</span><span class="n">translator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_preamble</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">out_type</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">dump_storage</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_decl</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">out_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_epilog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">eof</span><span class="p">()</span></div>

<div class="viewcode-block" id="Parser.close"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>           <span class="c1"># end parsing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">eof</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># log requested but missed documentation</span>
        <span class="n">log_missed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">error_missing</span><span class="p">:</span>
            <span class="n">log_missed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warn</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="p">,</span> <span class="n">NullTranslator</span><span class="p">):</span>
            <span class="c1"># the NullTranslator does not translate / translated_names is</span>
            <span class="c1"># empty</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="p">,</span> <span class="n">ListTranslator</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_dump_storage</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">use_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">translated_names</span><span class="p">:</span>
                    <span class="n">log_missed</span><span class="p">(</span><span class="s2">&quot;no documentation for &#39;</span><span class="si">%(name)s</span><span class="s2">&#39; found&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;total errors: </span><span class="si">%(errors)s</span><span class="s2"> / total warnings: </span><span class="si">%(warnings)s</span><span class="s2">&quot;</span>
                      <span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">global</span> <span class="n">INSPECT</span> <span class="c1"># pylint: disable=W0603</span>
        <span class="n">INSPECT</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Parser.feed"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.feed">[docs]</a>    <span class="k">def</span> <span class="nf">feed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">eof</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span> <span class="o">+</span> <span class="n">data</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">gather_context</span><span class="p">:</span>
            <span class="c1"># Scan additional context from the parsed source. For this, collect</span>
            <span class="c1"># all lines in self.rawdata until EOF. On EOF, scan rawdata about</span>
            <span class="c1"># (e.g.) exported symbols and after this, continue with the *normal*</span>
            <span class="c1"># parsing.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">eof</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gather_context</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">eof</span><span class="p">:</span>
            <span class="c1"># keep last line, until EOF</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rawdata</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">expandtabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">tab_width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">filter_opt</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">SNIP</span><span class="p">:</span>
                <span class="c1"># record snippet</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">snippets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">SNIP</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">or</span> <span class="n">l</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">snippets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">SNIP</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">state</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;state_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">state</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_exc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;total errors: </span><span class="si">%(errors)s</span><span class="s2"> / warnings: </span><span class="si">%(warnings)s</span><span class="s2">&quot;</span>
                           <span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;unhandled exception in line: </span><span class="si">%(l)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
                <span class="k">raise</span></div>

<div class="viewcode-block" id="Parser.output_decl"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.output_decl">[docs]</a>    <span class="k">def</span> <span class="nf">output_decl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">out_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">dumped_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;name &#39;</span><span class="si">%s</span><span class="s2">&#39; used several times&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">dumped_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="p">,</span> <span class="n">NullTranslator</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">dump_storage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span> <span class="n">name</span>
                  <span class="p">,</span> <span class="n">out_type</span>
                  <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">dumpOptions</span><span class="p">()</span>
                  <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">dumpCtx</span><span class="p">()</span>
                  <span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">do_translate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">skip_names</span><span class="p">:</span>
            <span class="n">do_translate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">use_names</span><span class="p">:</span>
            <span class="n">do_translate</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">out_type</span> <span class="o">!=</span> <span class="s2">&quot;DOC&quot;</span>  <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">use_names</span><span class="p">:</span>
            <span class="n">do_translate</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">out_type</span> <span class="o">==</span> <span class="s2">&quot;DOC&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">use_all_docs</span><span class="p">:</span>
            <span class="n">do_translate</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">do_translate</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">translated_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">out_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="p">,</span> <span class="s2">&quot;output_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">out_type</span><span class="p">)</span>
            <span class="n">out_func</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;skip translation of </span><span class="si">%(t)s</span><span class="s2">: &#39;</span><span class="si">%(n)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">out_type</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.state_0"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.state_0">[docs]</a>    <span class="k">def</span> <span class="nf">state_0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;state: 0 - normal code&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">doc_start</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;START: kernel-doc comment / switch state 0 --&gt; 1&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_doc_sect</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Parser.state_1"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.state_1">[docs]</a>    <span class="k">def</span> <span class="nf">state_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;state: 1 - looking for function name&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">doc_block</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;START: DOC block / switch state 1 --&gt; 4&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">section_intro</span>
            <span class="k">if</span> <span class="n">doc_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_title</span><span class="p">(</span><span class="n">doc_block</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;DOC: </span><span class="si">%(sect)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">doc_decl</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;START: declaration / switch state 1 --&gt; 2&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="n">identifier</span> <span class="o">=</span> <span class="n">doc_decl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span> <span class="o">=</span> <span class="s2">&quot;function&quot;</span>
            <span class="k">if</span> <span class="n">doc_decl_ident</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="n">identifier</span> <span class="o">=</span> <span class="n">doc_decl_ident</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span> <span class="o">=</span> <span class="n">doc_decl_ident</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span> <span class="o">=</span> <span class="n">identifier</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;FLAG: in_purpose=True&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_purpose</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;scanning doc for: </span><span class="si">%(t)s</span><span class="s2"> &#39;</span><span class="si">%(i)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">identifier</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">doc_decl_purpose</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span> <span class="o">=</span> <span class="n">doc_decl_purpose</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;missing initial short description of &#39;</span><span class="si">%(i)s</span><span class="s2">&#39;&quot;</span>
                          <span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;can&#39;t understand: --&gt;|</span><span class="si">%(line)s</span><span class="s2">|&lt;--&quot;</span>
                      <span class="s2">&quot; - I thought it was a doc line&quot;</span> <span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Parser.sect_title"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.sect_title">[docs]</a>    <span class="k">def</span> <span class="nf">sect_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Normalize common section titles&quot;&quot;&quot;</span>
        <span class="c1"># fix varius notations for the &quot;Return:&quot; section</span>

        <span class="n">retVal</span> <span class="o">=</span> <span class="n">title</span>

        <span class="k">if</span> <span class="n">title</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="p">]:</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_descr</span>

        <span class="k">elif</span> <span class="n">title</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;introduction&quot;</span><span class="p">,</span> <span class="s2">&quot;intro&quot;</span><span class="p">]:</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_intro</span>

        <span class="k">elif</span> <span class="n">title</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="p">]:</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_context</span>

        <span class="k">elif</span> <span class="n">title</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;return&quot;</span><span class="p">,</span> <span class="s2">&quot;returns&quot;</span><span class="p">]:</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_return</span>

        <span class="k">return</span> <span class="n">retVal</span></div>

<div class="viewcode-block" id="Parser.state_2"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.state_2">[docs]</a>    <span class="k">def</span> <span class="nf">state_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;state: 2 - scanning field start. &quot;&quot;&quot;</span>

        <span class="n">new_sect</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">new_cont</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">doc_sect_except</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>

            <span class="c1"># probe different sect start pattern ...</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">markup</span> <span class="o">==</span> <span class="s2">&quot;reST&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">doc_sect_reST</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="c1"># this is a line with a parameter definition or vintage</span>
                    <span class="c1"># section &quot;Context: lorem&quot;, &quot;Return: lorem&quot; etc.</span>
                    <span class="n">new_sect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_title</span><span class="p">(</span><span class="n">doc_sect_reST</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">new_cont</span> <span class="o">=</span> <span class="n">doc_sect_reST</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">reST_sect</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="c1"># this is a line with a section definition &quot;Section name:\n&quot;</span>
                    <span class="n">new_sect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_title</span><span class="p">(</span><span class="n">reST_sect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">new_cont</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="c1"># Sub-sections in parameter descriptions are not provided,</span>
                <span class="c1"># with the exception of special_sections names. To allow</span>
                <span class="c1"># comments like:</span>
                <span class="c1">#   * @arg: lorem</span>
                <span class="c1">#   * Return: foo</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">new_sect</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">new_sect</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">new_sect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">special_sections</span> <span class="p">):</span>
                    <span class="n">new_sect</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">new_cont</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># kernel-doc vintage mode</span>
                <span class="k">if</span> <span class="n">doc_sect</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                    <span class="c1"># this is a line with a parameter or section definition</span>
                    <span class="n">new_sect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_title</span><span class="p">(</span><span class="n">doc_sect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">new_cont</span> <span class="o">=</span> <span class="n">doc_sect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">new_sect</span><span class="p">:</span>

            <span class="c1"># a new section starts *here*</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;found new section --&gt; </span><span class="si">%(sect)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sect</span><span class="o">=</span><span class="n">new_sect</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_doc_sect</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;contents before sections &#39;</span><span class="si">%(c)s</span><span class="s2">&#39;&quot;</span> <span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_default</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;new_sect: &#39;</span><span class="si">%(sec)s</span><span class="s2">&#39; / desc: &#39;</span><span class="si">%(desc)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">sec</span> <span class="o">=</span> <span class="n">new_sect</span><span class="p">,</span> <span class="n">desc</span> <span class="o">=</span> <span class="n">new_cont</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">in_doc_sect</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_purpose</span>  <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;FLAGs: in_doc_sect=</span><span class="si">%(s)s</span><span class="s2"> / in_purpose=</span><span class="si">%(p)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_doc_sect</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_purpose</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span>  <span class="o">=</span> <span class="n">new_sect</span>
            <span class="k">if</span> <span class="n">new_cont</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="n">new_cont</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;section: </span><span class="si">%(sec)s</span><span class="s2">&quot;</span> <span class="p">,</span> <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">doc_end</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>

            <span class="c1"># end of the comment-block</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_default</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="c1"># look for doc_com + &lt;text&gt; + doc_end:</span>
            <span class="k">if</span> <span class="n">RE</span><span class="p">(</span><span class="n">doc_com</span><span class="o">.</span><span class="n">pattern</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;[a-zA-Z_0-9:\.]+&quot;</span> <span class="o">+</span> <span class="n">doc_end</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;suspicious ending line&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;END doc block / switch state 2 --&gt; 3&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;end of doc comment, looking for prototype&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span>   <span class="o">=</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">brcount</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="n">doc_content</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>

            <span class="c1"># a comment line with *content* of a section or a *purpose*</span>

            <span class="n">cont_line</span> <span class="o">=</span> <span class="n">doc_content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">cont_line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="c1"># it&#39;s a empty line</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_purpose</span><span class="p">:</span>

                    <span class="c1"># empty line after short description (*purpose*) introduce the</span>
                    <span class="c1"># &quot;Description&quot; section</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;found empty line in *purpose* --&gt; start &#39;Description&#39; section&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_doc_sect</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;contents before sections &#39;</span><span class="si">%(c)s</span><span class="s2">&#39;&quot;</span> <span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dump_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_descr</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_doc_sect</span>  <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_purpose</span>   <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;FLAGs: in_doc_sect=</span><span class="si">%(s)s</span><span class="s2"> / in_purpose=</span><span class="si">%(p)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_doc_sect</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_purpose</span><span class="p">)</span>

                <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)</span>
                      <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_context</span><span class="p">):</span>

                    <span class="c1"># miguel-style comment kludge, look for blank lines after @parameter</span>
                    <span class="c1"># line to signify start of description</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;blank lines after @parameter --&gt; start &#39;Description&#39; section&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dump_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_descr</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_doc_sect</span>  <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;FLAGs: in_doc_sect=</span><span class="si">%(s)s</span><span class="s2"> / in_purpose=</span><span class="si">%(p)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_doc_sect</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_purpose</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_purpose</span><span class="p">:</span>
                <span class="c1"># Continued declaration purpose, dismiss leading whitespace</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">cont_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span> <span class="o">=</span> <span class="n">cont_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">markup</span> <span class="o">==</span> <span class="s2">&quot;reST&quot;</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)):</span>
                    <span class="c1"># FIXME: I doubt if it is a good idea to strip leading</span>
                    <span class="c1"># whitespaces in parameter description, but *over all* we</span>
                    <span class="c1"># get better reST output.</span>
                    <span class="n">cont_line</span> <span class="o">=</span> <span class="n">cont_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="c1"># Sub-sections in parameter descriptions are not provided,</span>
                    <span class="c1"># but if this is a &quot;lorem:\n&quot; line create a new paragraph.</span>
                    <span class="k">if</span> <span class="n">reST_sect</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">doc_sect_except</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                        <span class="n">cont_line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">cont_line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">+=</span> <span class="n">cont_line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># i dont know - bad line?  ignore.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;bad line: &#39;</span><span class="si">%(line)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>

<div class="viewcode-block" id="Parser.state_3"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.state_3">[docs]</a>    <span class="k">def</span> <span class="nf">state_3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;state: 3 - scanning prototype.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;typedef&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span> <span class="o">==</span> <span class="s1">&#39;typedef&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;typedef of function pointer not marked&quot;</span>
                    <span class="s2">&quot; as typdef, use: &#39;typedef </span><span class="si">%s</span><span class="s2">&#39; in the comment.&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span><span class="p">)</span>
                    <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span> <span class="o">=</span> <span class="s1">&#39;typedef&#39;</span>

        <span class="k">if</span> <span class="n">doc_state5_oneline</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="n">sect</span> <span class="o">=</span> <span class="n">doc_state5_oneline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">doc_state5_oneline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cont</span> <span class="ow">and</span> <span class="n">sect</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_title</span><span class="p">(</span><span class="n">sect</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="n">cont</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_default</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">elif</span> <span class="n">doc_state5_start</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;FLAG: split_doc_state=1 / switch state 3 --&gt; 5&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">split_doc_state</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;odd construct, gathering documentation of a function&quot;</span>
                           <span class="s2">&quot; outside of the main block?!?&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_state3_function</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_state3_type</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.state_4"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.state_4">[docs]</a>    <span class="k">def</span> <span class="nf">state_4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;state: 4 - documentation block&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">doc_block</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="c1"># a new DOC block arrived, dump the last section and pass the new</span>
            <span class="c1"># DOC block to state 1.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_DOC</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;END &amp; START: DOC block / switch state 4 --&gt; 1&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_1</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">doc_end</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="c1"># the DOC block ends here, dump it and reset to state 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;END: DOC block / dump doc section / switch state 4 --&gt; 0&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_DOC</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="n">doc_content</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="n">cont</span> <span class="o">=</span> <span class="n">doc_content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">cont</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># dismiss leading newlines</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">+=</span> <span class="n">doc_content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span></div>

<div class="viewcode-block" id="Parser.state_5"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.state_5">[docs]</a>    <span class="k">def</span> <span class="nf">state_5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;state: 5 - gathering documentation outside main block&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">split_doc_state</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="n">doc_state5_sect</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)):</span>

            <span class="c1"># First line (split_doc_state 1) needs to be a @parameter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_title</span><span class="p">(</span><span class="n">doc_state5_sect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="n">doc_state5_sect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">split_doc_state</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SPLIT-DOC-START: &#39;</span><span class="si">%(param)s</span><span class="s2">&#39; / split-state 1 --&gt; 2&quot;</span>
                       <span class="p">,</span> <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">line_no</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;section: </span><span class="si">%(sec)s</span><span class="s2">&quot;</span> <span class="p">,</span> <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">doc_state5_end</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="c1"># Documentation block end</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SPLIT-DOC-END: ...&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SPLIT-DOC-END: ... no description to dump&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dump_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">section</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_default</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;SPLIT-DOC-END: ... split-state --&gt; 0  / state = 3&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">split_doc_state</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="n">doc_content</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="c1"># Regular text</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_doc_state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">contents</span> <span class="o">+=</span> <span class="n">doc_content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_doc_state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">split_doc_state</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Comment without header was found split-state --&gt; 4&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Incorrect use of kernel-doc format: </span><span class="si">%(line)s</span><span class="s2">&quot;</span>
                          <span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------</span>
    <span class="c1"># helper to parse special objects</span>
    <span class="c1"># ------------------------------------------------------------</span>

<div class="viewcode-block" id="Parser.process_state3_function"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.process_state3_function">[docs]</a>    <span class="k">def</span> <span class="nf">process_state3_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PROCESS-FUNCTION: </span><span class="si">%(line)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">C99_comments</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="c1"># strip C99-style comments to end of line</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">stripProto</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([^\{]*)&quot;</span><span class="p">)</span>

        <span class="c1"># ?!?!? MACDOC does not exists (any more)?</span>
        <span class="c1"># if ($x =~ m#\s*/\*\s+MACDOC\s*#io || ($x =~ /^#/ &amp;&amp; $x !~ /^#\s*define/)) {</span>
        <span class="c1">#   do nothing</span>
        <span class="c1"># }</span>

        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">MACRO_define</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="c1"># do nothing</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">stripProto</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">stripProto</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">MACRO_define</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="ow">or</span> <span class="s2">&quot;{&quot;</span> <span class="ow">in</span> <span class="n">line</span>
            <span class="ow">or</span> <span class="s2">&quot;;&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="p">):</span>

            <span class="c1"># strip cr&amp;nl, strip C89 comments, strip leading whitespaces</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span> <span class="o">=</span> <span class="n">C89_comments</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">CR_NL</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">))</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">SYSCALL_DEFINE</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">syscall_munge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">TRACE_EVENT</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">DEFINE_EVENT</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">DEFINE_SINGLE_EVENT</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span> <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracepoint_munge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;prototype --&gt; &#39;</span><span class="si">%(proto)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_state</span><span class="p">()</span></div>

<div class="viewcode-block" id="Parser.syscall_munge"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.syscall_munge">[docs]</a>    <span class="k">def</span> <span class="nf">syscall_munge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prototype</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;syscall munge: &#39;</span><span class="si">%(prototype)s</span><span class="s2">&#39;&quot;</span> <span class="p">,</span> <span class="n">prototype</span><span class="o">=</span><span class="n">prototype</span><span class="p">)</span>
        <span class="n">void</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># strip needles whitespaces</span>
        <span class="n">prototype</span> <span class="o">=</span> <span class="n">normalize_ws</span><span class="p">(</span><span class="n">prototype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">SYSCALL_DEFINE0</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">prototype</span><span class="p">):</span>
            <span class="n">void</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">prototype</span> <span class="o">=</span> <span class="n">SYSCALL_DEFINE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;long sys_&quot;</span><span class="p">,</span> <span class="n">prototype</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sys_&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span> <span class="o">=</span> <span class="s2">&quot;sys_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span>

        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;long (sys_.*?),&quot;</span><span class="p">,</span> <span class="n">prototype</span><span class="p">):</span>
            <span class="n">prototype</span> <span class="o">=</span> <span class="n">prototype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">void</span><span class="p">:</span>
            <span class="n">prototype</span> <span class="o">=</span> <span class="n">prototype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span><span class="s2">&quot;(void)&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># now delete all of the odd-number commas in $prototype</span>
        <span class="c1"># so that arg types &amp; arg names don&#39;t have a comma between them</span>

        <span class="n">retVal</span> <span class="o">=</span> <span class="n">prototype</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">void</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">prototype</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;syscall munge: retVal &#39;</span><span class="si">%(retVal)s</span><span class="s2">&#39;&quot;</span> <span class="p">,</span> <span class="n">retVal</span><span class="o">=</span><span class="n">retVal</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retVal</span></div>

<div class="viewcode-block" id="Parser.tracepoint_munge"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.tracepoint_munge">[docs]</a>    <span class="k">def</span> <span class="nf">tracepoint_munge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prototype</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;tracepoint munge: </span><span class="si">%(prototype)s</span><span class="s2">&quot;</span> <span class="p">,</span> <span class="n">prototype</span><span class="o">=</span><span class="n">prototype</span><span class="p">)</span>

        <span class="n">retVal</span>  <span class="o">=</span> <span class="n">prototype</span>
        <span class="n">tp_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">tp_args</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">TRACE_EVENT_name</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">prototype</span><span class="p">):</span>
            <span class="n">tp_name</span> <span class="o">=</span> <span class="n">TRACE_EVENT_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">DEFINE_SINGLE_EVENT_name</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">prototype</span><span class="p">):</span>
            <span class="n">tp_name</span> <span class="o">=</span> <span class="n">DEFINE_SINGLE_EVENT_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">DEFINE_EVENT_name</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">prototype</span><span class="p">):</span>
            <span class="n">tp_name</span> <span class="o">=</span> <span class="n">DEFINE_EVENT_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">tp_name</span> <span class="o">=</span> <span class="n">tp_name</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">TP_PROTO</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">prototype</span><span class="p">):</span>
            <span class="n">tp_args</span> <span class="o">=</span> <span class="n">TP_PROTO</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tp_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">tp_args</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Unrecognized tracepoint format: </span><span class="si">%(prototype)s</span><span class="s2">&quot;</span>
                      <span class="p">,</span> <span class="n">prototype</span><span class="o">=</span><span class="n">prototype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;trace_&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span> <span class="o">=</span> <span class="s2">&quot;trace_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;static inline void trace_</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span>
                      <span class="o">%</span> <span class="p">(</span><span class="n">tp_name</span><span class="p">,</span> <span class="n">tp_args</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">retVal</span></div>

<div class="viewcode-block" id="Parser.process_state3_type"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.process_state3_type">[docs]</a>    <span class="k">def</span> <span class="nf">process_state3_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PROCESS-TYPE: </span><span class="si">%(line)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">)</span>

        <span class="c1"># strip cr&amp;nl, strip C99 comments, strip leading&amp;trailing whitespaces</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">C99_comments</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">CR_NL</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">MACRO</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="c1"># To distinguish preprocessor directive from regular declaration</span>
            <span class="c1"># later (drop-semicolon).</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([^</span><span class="si">{}</span><span class="s2">;]*)([</span><span class="si">{}</span><span class="s2">;])(.*)&quot;</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span> <span class="o">+=</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;{&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">brcount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;}&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">brcount</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;;&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">brcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;prototype --&gt; &#39;</span><span class="si">%(proto)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;decl_type: </span><span class="si">%(decl_type)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">decl_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span> <span class="o">==</span> <span class="s2">&quot;union&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dump_union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span> <span class="o">==</span> <span class="s2">&quot;struct&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dump_struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span> <span class="o">==</span> <span class="s2">&quot;enum&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dump_enum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span> <span class="o">==</span> <span class="s2">&quot;typedef&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dump_typedef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ParserBuggy</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;unknown decl_type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">reset_state</span><span class="p">()</span>
                    <span class="k">break</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span> <span class="o">+=</span> <span class="n">line</span>
                <span class="k">break</span></div>

    <span class="c1"># ------------------------------------------------------------</span>
    <span class="c1"># dump objects</span>
    <span class="c1"># ------------------------------------------------------------</span>

<div class="viewcode-block" id="Parser.dump_preamble"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.dump_preamble">[docs]</a>    <span class="k">def</span> <span class="nf">dump_preamble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">skip_preamble</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">output_preamble</span><span class="p">()</span></div>

<div class="viewcode-block" id="Parser.dump_epilog"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.dump_epilog">[docs]</a>    <span class="k">def</span> <span class="nf">dump_epilog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">skip_epilog</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">translator</span><span class="o">.</span><span class="n">output_epilog</span><span class="p">()</span></div>

<div class="viewcode-block" id="Parser.dump_section"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.dump_section">[docs]</a>    <span class="k">def</span> <span class="nf">dump_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cont</span><span class="p">):</span>
        <span class="sa">u</span><span class="sd">&quot;&quot;&quot;Store section&#39;s *content* under it&#39;s name.</span>

<span class="sd">        :param str name: name of the section</span>
<span class="sd">        :param str cont: content of the section</span>

<span class="sd">        Stores the *content* under section&#39;s *name* in one of the *container*. A</span>
<span class="sd">        container is a hash object, the section name is the *key* and the</span>
<span class="sd">        content is the *value*.</span>

<span class="sd">        Container:</span>

<span class="sd">        * self.ctx.constants:       holds constant&#39;s descriptions</span>
<span class="sd">        * self.ctx.parameterdescs:  holds parameter&#39;s descriptions</span>
<span class="sd">        * self.ctx.sections:        holds common sections like &quot;Return:&quot;</span>

<span class="sd">        There are the following contai</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dump_section(): </span><span class="si">%(name)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">cont</span> <span class="o">=</span> <span class="n">cont</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="c1"># dismiss trailing whitespace</span>
        <span class="c1"># FIXME: sections with &#39;%CONST&#39; prefix no longer exists</span>
        <span class="c1"># _type_constant     = RE(r&quot;\%([-_\w]+)&quot;)</span>
        <span class="c1">#if _type_constant.match(name):  # &#39;%CONST&#39; - name of a constant.</span>
        <span class="c1">#    name = _type_constant[0]</span>
        <span class="c1">#    self.debug(&quot;constant section &#39;%(name)s&#39;&quot;,  name = name)</span>
        <span class="c1">#    if self.ctx.constants.get(name, None):</span>
        <span class="c1">#        self.error(&quot;duplicate constant definition &#39;%(name)s&#39;&quot;</span>
        <span class="c1">#                   , name = name)</span>
        <span class="c1">#    self.ctx.constants[name] = cont</span>

        <span class="n">_type_param</span>  <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\@(\w[.\w]*)&quot;</span><span class="p">)</span>  <span class="c1"># match @foo and @foo.bar</span>
        <span class="k">if</span> <span class="n">_type_param</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>   <span class="c1"># &#39;@parameter&#39; - name of a parameter</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">_type_param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;parameter definition &#39;</span><span class="si">%(name)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;duplicate parameter definition &#39;</span><span class="si">%(name)s</span><span class="s2">&#39;&quot;</span>
                           <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cont</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="o">.</span><span class="n">offsets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sectcheck</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;@...&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;parameter definiton &#39;...&#39;&quot;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;parameter definiton &#39;...&#39;&quot;</span>
                           <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cont</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="o">.</span><span class="n">offsets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sectcheck</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;other section &#39;</span><span class="si">%(name)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;duplicate section name &#39;</span><span class="si">%(name)s</span><span class="s2">&#39;&quot;</span>
                          <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">cont</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cont</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">offsets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span></div>

<div class="viewcode-block" id="Parser.dump_function"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.dump_function">[docs]</a>    <span class="k">def</span> <span class="nf">dump_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dump_function(): (1) &#39;</span><span class="si">%(proto)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
        <span class="n">hasRetVal</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;^static +&quot;</span>         <span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;^extern +&quot;</span>         <span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;^asmlinkage +&quot;</span>     <span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;^inline +&quot;</span>         <span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;^__inline__ +&quot;</span>     <span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;^__inline +&quot;</span>       <span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;^__always_inline +&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;^noinline +&quot;</span>       <span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;__init +&quot;</span>          <span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;__init_or_module +&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;__meminit +&quot;</span>       <span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;__must_check +&quot;</span>    <span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;__weak +&quot;</span>          <span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>

        <span class="n">define</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">MACRO_define</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">proto</span><span class="p">))</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">MACRO_define</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span> <span class="p">)</span>

        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="sa">r</span><span class="s2">&quot;__attribute__\s*\(\(&quot;</span>
                        <span class="sa">r</span><span class="s2">&quot;(?:&quot;</span>
                        <span class="sa">r</span><span class="s2">&quot;[\w\s]+&quot;</span>          <span class="c1"># attribute name</span>
                        <span class="sa">r</span><span class="s2">&quot;(?:\([^)]*\))?&quot;</span>   <span class="c1"># attribute arguments</span>
                        <span class="sa">r</span><span class="s2">&quot;\s*,?&quot;</span>            <span class="c1"># optional comma at the end</span>
                        <span class="sa">r</span><span class="s2">&quot;)+&quot;</span>
                        <span class="sa">r</span><span class="s2">&quot;\)\)\s+&quot;</span>
                        <span class="p">,</span> <span class="s2">&quot;&quot;</span>
                        <span class="p">,</span> <span class="n">proto</span><span class="p">)</span>

        <span class="c1"># Yes, this truly is vile.  We are looking for:</span>
        <span class="c1"># 1. Return type (may be nothing if we&#39;re looking at a macro)</span>
        <span class="c1"># 2. Function name</span>
        <span class="c1"># 3. Function parameters.</span>
        <span class="c1">#</span>
        <span class="c1"># All the while we have to watch out for function pointer parameters</span>
        <span class="c1"># (which IIRC is what the two sections are for), C types (these</span>
        <span class="c1"># regexps don&#39;t even start to express all the possibilities), and</span>
        <span class="c1"># so on.</span>
        <span class="c1">#</span>
        <span class="c1"># If you mess with these regexps, it&#39;s a good idea to check that</span>
        <span class="c1"># the following functions&#39; documentation still comes out right:</span>
        <span class="c1"># - parport_register_device (function pointer parameters)</span>
        <span class="c1"># - atomic_set (macro)</span>
        <span class="c1"># - pci_match_device, __copy_to_user (long return type)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dump_function(): (2) &#39;</span><span class="si">%(proto)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^()([a-zA-Z0-9_~:]+)\s+&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">define</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">proto</span><span class="p">):</span>
            <span class="c1"># This is an object-like macro, it has no return type and no</span>
            <span class="c1"># parameter list.  Function-like macros are not allowed to have</span>
            <span class="c1"># spaces between decl_name and opening parenthesis (notice</span>
            <span class="c1"># the \s+).</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">return_type</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>   <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">hasRetVal</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dump_function(): (hasRetVal = False) &#39;</span><span class="si">%(proto)s</span><span class="s2">&#39;&quot;</span>
                       <span class="p">,</span> <span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">matchExpr</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">regexp</span> <span class="ow">in</span> <span class="n">FUNC_PROTOTYPES</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">proto</span><span class="p">):</span>
                    <span class="n">matchExpr</span> <span class="o">=</span> <span class="n">regexp</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dump_function(): matchExpr = &#39;</span><span class="si">%(pattern)s</span><span class="s2">&#39; // &#39;</span><span class="si">%(proto)s</span><span class="s2">&#39;&quot;</span>
                               <span class="p">,</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">matchExpr</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">matchExpr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dump_function(): return_type=&#39;</span><span class="si">%(x)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">matchExpr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">return_type</span> <span class="o">=</span> <span class="n">matchExpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dump_function(): decl_name=&#39;</span><span class="si">%(x)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">matchExpr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>   <span class="o">=</span> <span class="n">matchExpr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_parameterlist</span><span class="p">(</span><span class="n">matchExpr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;can&#39;t understand function proto: &#39;</span><span class="si">%(prototype)s</span><span class="s2">&#39;&quot;</span>
                          <span class="p">,</span> <span class="n">prototype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">prototype</span>
                          <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;function name from comment differs:  </span><span class="si">%s</span><span class="s2"> &lt;--&gt; </span><span class="si">%s</span><span class="s2">&quot;</span>
                          <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">)</span>
                          <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_sections</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
                            <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span>
                            <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sectcheck</span>
                            <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span>
                            <span class="p">)</span>
        <span class="k">if</span> <span class="n">hasRetVal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_return_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">return_type</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_decl</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">,</span> <span class="s2">&quot;function_decl&quot;</span>
            <span class="p">,</span> <span class="n">function</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
            <span class="p">,</span> <span class="n">return_type</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">return_type</span>
            <span class="p">,</span> <span class="n">parameterlist</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span>
            <span class="p">,</span> <span class="n">parameterdescs</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span>
            <span class="p">,</span> <span class="n">parametertypes</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parametertypes</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span>
            <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span> <span class="p">)</span></div>

<div class="viewcode-block" id="Parser.dump_DOC"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.dump_DOC">[docs]</a>    <span class="k">def</span> <span class="nf">dump_DOC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">cont</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_section</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cont</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_decl</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;DOC&quot;</span>
                         <span class="p">,</span> <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span> <span class="p">)</span></div>

<div class="viewcode-block" id="Parser.dump_union"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.dump_union">[docs]</a>    <span class="k">def</span> <span class="nf">dump_union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_struct_union</span><span class="p">(</span><span class="n">proto</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;can&#39;t parse union!&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;struct name from comment differs:  </span><span class="si">%s</span><span class="s2"> &lt;--&gt; </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">)</span>
                      <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_decl</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">,</span> <span class="s2">&quot;union_decl&quot;</span>
            <span class="p">,</span> <span class="n">decl_name</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
            <span class="p">,</span> <span class="n">decl_type</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span>
            <span class="p">,</span> <span class="n">parameterlist</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span>
            <span class="p">,</span> <span class="n">parameterdescs</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span>
            <span class="p">,</span> <span class="n">parametertypes</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parametertypes</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span>
            <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span>
            <span class="p">,</span> <span class="n">definition</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">definition</span> <span class="p">)</span></div>

<div class="viewcode-block" id="Parser.dump_struct"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.dump_struct">[docs]</a>    <span class="k">def</span> <span class="nf">dump_struct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_struct_union</span><span class="p">(</span><span class="n">proto</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;can&#39;t parse struct!&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;struct name from comment differs:  </span><span class="si">%s</span><span class="s2"> &lt;--&gt; </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">)</span>
                      <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_decl</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">,</span> <span class="s2">&quot;struct_decl&quot;</span>
            <span class="p">,</span> <span class="n">decl_name</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
            <span class="p">,</span> <span class="n">decl_type</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span>
            <span class="p">,</span> <span class="n">parameterlist</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span>
            <span class="p">,</span> <span class="n">parameterdescs</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span>
            <span class="p">,</span> <span class="n">parametertypes</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parametertypes</span>
            <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span>
            <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span>
            <span class="p">,</span> <span class="n">definition</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">definition</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.prepare_struct_union"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.prepare_struct_union">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_struct_union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;prepare_struct_union(): &#39;</span><span class="si">%(proto)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>

        <span class="n">retVal</span>  <span class="o">=</span> <span class="kc">False</span>
        <span class="n">members</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># ignore members marked private:</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/\*\s*private:.*?\/\*\s*public:.*?\*\/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/\*\s*private:.*$&quot;</span><span class="p">,</span> <span class="s2">&quot;};&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">C_STRUCT_UNION</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">proto</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">C_STRUCT_UNION</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;determine of decl_type is inconsistent: &#39;</span><span class="si">%s</span><span class="s2">&#39; &lt;--&gt; &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                           <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">prototype: </span><span class="si">%s</span><span class="s2">&quot;</span>
                           <span class="o">%</span> <span class="p">(</span><span class="n">C_STRUCT_UNION</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span><span class="p">,</span> <span class="n">proto</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span> <span class="o">=</span> <span class="n">C_STRUCT_UNION</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">definition</span> <span class="o">=</span> <span class="n">members</span> <span class="o">=</span> <span class="n">C89_comments</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">C_STRUCT_UNION</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

            <span class="c1"># strip kmemcheck_bitfield_{begin,end}.*;</span>
            <span class="n">members</span> <span class="o">=</span>  <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;kmemcheck_bitfield_.*?;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">members</span><span class="p">)</span>

            <span class="c1"># strip attributes</span>
            <span class="n">members</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;__attribute__\s*\(\([a-z,_\*\s\(\)]*\)\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">members</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
            <span class="n">members</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;__aligned\s*\([^;]*\)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">members</span><span class="p">)</span>
            <span class="n">members</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*CRYPTO_MINALIGN_ATTR&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">members</span><span class="p">)</span>

            <span class="c1"># replace DECLARE_BITMAP</span>
            <span class="n">members</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;DECLARE_BITMAP\s*\(([^,)]+), ([^,)]+)\)&quot;</span>
                             <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;unsigned long \1[BITS_TO_LONGS(\2)]&quot;</span>
                             <span class="p">,</span> <span class="n">members</span> <span class="p">)</span>

            <span class="c1"># replace DECLARE_HASHTABLE</span>
            <span class="n">members</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;DECLARE_HASHTABLE\s*\(([^,)]+), ([^,)]+)\)&quot;</span>
                             <span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;unsigned long \1[1 &lt;&lt; ((\2) - 1)]&quot;</span>
                             <span class="p">,</span> <span class="n">members</span> <span class="p">)</span>

            <span class="c1"># Split nested struct/union elements as newer ones</span>
            <span class="n">NESTED</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(struct|union)([^</span><span class="si">{}</span><span class="s2">;]+){([^</span><span class="si">{}</span><span class="s2">]*)}([^</span><span class="si">{}</span><span class="s2">\;]*)\;&quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">NESTED</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">members</span><span class="p">):</span>
                <span class="n">n_content</span> <span class="o">=</span> <span class="n">NESTED</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">n_ids</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[:\[].*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">NESTED</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">n_new</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="c1"># union car {int foo;} bar1, bar2, *bbar3;</span>
                <span class="k">for</span> <span class="n">n_id</span> <span class="ow">in</span> <span class="n">n_ids</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                    <span class="n">n_id</span> <span class="o">=</span> <span class="n">n_id</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">n_new</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">NESTED</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">n_id</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">n_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">):</span>
                        <span class="n">arg</span> <span class="o">=</span> <span class="n">normalize_ws</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                        <span class="c1"># suppport bit types e.g. &#39;__u8 arg1 : 1&#39; --&gt; &#39;__u8 arg1&#39;</span>
                        <span class="n">arg</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;\s*:\s*[0-9]+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">arg</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">n_type</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">n_name</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">n_name</span> <span class="o">==</span> <span class="n">n_type</span><span class="p">:</span>
                            <span class="c1"># anonymous struct/union</span>
                            <span class="n">n_new</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n_type</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="ow">not</span> <span class="n">n_id</span><span class="p">:</span>
                            <span class="n">n_new</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n_type</span><span class="p">,</span> <span class="n">n_name</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">n_new</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n_type</span><span class="p">,</span> <span class="n">n_id</span><span class="p">,</span> <span class="n">n_name</span><span class="p">)</span>
                <span class="n">members</span> <span class="o">=</span> <span class="n">NESTED</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">n_new</span><span class="p">,</span> <span class="n">members</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># ignore other nested elements, like enums</span>
            <span class="n">members</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;({[^\{\}]*})&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">members</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_parameterlist</span><span class="p">(</span><span class="n">members</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_sections</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
                                <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span>
                                <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sectcheck</span>
                                <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span> <span class="c1"># self.ctx.struct_actual.split(&quot; &quot;)</span>
                                <span class="p">)</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">retVal</span></div>

<div class="viewcode-block" id="Parser.dump_enum"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.dump_enum">[docs]</a>    <span class="k">def</span> <span class="nf">dump_enum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dump_enum(): &#39;</span><span class="si">%(proto)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>

        <span class="n">proto</span> <span class="o">=</span> <span class="n">C89_comments</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
        <span class="c1"># strip #define macros inside enums</span>
        <span class="n">proto</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;#\s*((define|ifdef)\s+|endif)[^;]*;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>

        <span class="n">splitchar</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span>
        <span class="n">RE_NAME</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*(\w+).*&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">C_ENUM</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">proto</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span> <span class="o">=</span> <span class="n">C_ENUM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">members</span> <span class="o">=</span> <span class="n">normalize_ws</span><span class="p">(</span><span class="n">C_ENUM</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># drop trailing splitchar, if extists</span>
            <span class="k">if</span> <span class="n">members</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">splitchar</span><span class="p">):</span>
                <span class="n">members</span> <span class="o">=</span> <span class="n">members</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">splitchar</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">RE_NAME</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\1&quot;</span><span class="p">,</span> <span class="n">member</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;Enum value &#39;</span><span class="si">%(name)s</span><span class="s2">&#39; not described&quot;</span>
                        <span class="s2">&quot; in enum &#39;</span><span class="si">%(decl_name)s</span><span class="s2">&#39;&quot;</span>
                        <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>  <span class="n">decl_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parser</span><span class="o">.</span><span class="n">undescribed</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;enum name from comment differs:  </span><span class="si">%s</span><span class="s2"> &lt;--&gt; </span><span class="si">%s</span><span class="s2">&quot;</span>
                          <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">)</span>
                          <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">check_sections</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
                                <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span>
                                <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sectcheck</span>
                                <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span> <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">output_decl</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">,</span> <span class="s2">&quot;enum_decl&quot;</span>
                <span class="p">,</span> <span class="n">enum</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
                <span class="p">,</span> <span class="n">parameterlist</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span>
                <span class="p">,</span> <span class="n">parameterdescs</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span>
                <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span>
                <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span> <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;can&#39;t parse enum!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.dump_typedef"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.dump_typedef">[docs]</a>    <span class="k">def</span> <span class="nf">dump_typedef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proto</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dump_typedef(): &#39;</span><span class="si">%(proto)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>

        <span class="n">proto</span> <span class="o">=</span> <span class="n">C89_comments</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>

        <span class="n">matchExpr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">C_FUNC_TYPEDEF</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">proto</span><span class="p">):</span>
            <span class="n">matchExpr</span> <span class="o">=</span> <span class="n">C_FUNC_TYPEDEF</span>
        <span class="k">elif</span> <span class="n">C_FUNC_TYPEDEF_2</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">proto</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;typedef of function pointer used uncommon code style: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">proto</span><span class="p">)</span>
            <span class="n">matchExpr</span> <span class="o">=</span> <span class="n">C_FUNC_TYPEDEF_2</span>

        <span class="k">if</span> <span class="n">matchExpr</span><span class="p">:</span>
            <span class="c1"># Parse function prototypes</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">return_type</span> <span class="o">=</span> <span class="n">matchExpr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>   <span class="o">=</span> <span class="n">matchExpr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_return_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">return_type</span><span class="p">)</span>

            <span class="n">f_args</span> <span class="o">=</span> <span class="n">matchExpr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_parameterlist</span><span class="p">(</span><span class="n">f_args</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;function name from comment differs:  </span><span class="si">%s</span><span class="s2"> &lt;--&gt; </span><span class="si">%s</span><span class="s2">&quot;</span>
                          <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">)</span>
                          <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">check_sections</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
                                <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span>
                                <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sectcheck</span>
                                <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_decl</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">,</span> <span class="s2">&quot;function_decl&quot;</span>
                <span class="p">,</span> <span class="n">function</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
                <span class="p">,</span> <span class="n">return_type</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">return_type</span>
                <span class="p">,</span> <span class="n">parameterlist</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span>
                <span class="p">,</span> <span class="n">parameterdescs</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span>
                <span class="p">,</span> <span class="n">parametertypes</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parametertypes</span>
                <span class="p">,</span> <span class="n">sections</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span>
                <span class="p">,</span> <span class="n">purpose</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span> <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dump_typedef(): &#39;</span><span class="si">%(proto)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(*.\)\s*;$&quot;</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[*.\]\s*;$&quot;</span><span class="p">)</span>

            <span class="k">while</span> <span class="n">x1</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">proto</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x2</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">proto</span><span class="p">):</span>
                <span class="n">proto</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
                <span class="n">proto</span> <span class="o">=</span> <span class="n">x2</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;dump_typedef(): &#39;</span><span class="si">%(proto)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">proto</span><span class="o">=</span><span class="n">proto</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">C_TYPEDEF</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">proto</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span> <span class="o">=</span> <span class="n">C_TYPEDEF</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;typedef name from comment differs:  </span><span class="si">%s</span><span class="s2"> &lt;--&gt; </span><span class="si">%s</span><span class="s2">&quot;</span>
                              <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">)</span>
                              <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">check_sections</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
                                    <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_type</span>
                                    <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sectcheck</span>
                                    <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_decl</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span><span class="p">,</span> <span class="s2">&quot;typedef_decl&quot;</span>
                        <span class="p">,</span> <span class="n">typedef</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
                        <span class="p">,</span> <span class="n">sections</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span>
                        <span class="p">,</span> <span class="n">purpose</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_purpose</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;can&#39;t parse typedef!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.create_parameterlist"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.create_parameterlist">[docs]</a>    <span class="k">def</span> <span class="nf">create_parameterlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">splitchar</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;create_parameterlist(): splitchar=&#39;</span><span class="si">%(x)s</span><span class="s2">&#39; params=&#39;</span><span class="si">%(y)s</span><span class="s2">&#39;&quot;</span>
                   <span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">splitchar</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">parameter</span><span class="p">)</span>
        <span class="n">parameter</span> <span class="o">=</span> <span class="n">normalize_ws</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
        <span class="n">pointer_to_func</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(.+\)\s*\(&quot;</span><span class="p">)</span>

        <span class="c1"># temporarily replace commas inside function pointer definition</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\([^\),]+),&quot;</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">m</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">parameter</span><span class="p">):</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\1#&quot;</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span>
        <span class="c1"># drop trailing splitchar, if extists</span>
        <span class="k">if</span> <span class="n">parameter</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">splitchar</span><span class="p">):</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;create_parameterlist(): params=&#39;</span><span class="si">%(y)s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">parameter</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">splitchar</span><span class="p">)):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">C99_comments</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  parameter#</span><span class="si">%(c)s</span><span class="s2">: </span><span class="si">%(p)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
            <span class="n">p_type</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">p_name</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">MACRO</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>

                <span class="c1"># Treat preprocessor directive as a typeless variable just to</span>
                <span class="c1"># fill corresponding data structures &quot;correctly&quot;. Catch it later</span>
                <span class="c1"># in output_* subs.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  parameter#</span><span class="si">%(c)s</span><span class="s2">: (MACRO) </span><span class="si">%(p)s</span><span class="s2">=&#39;&#39;&quot;</span> <span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_parameter</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">pointer_to_func</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>

                <span class="c1"># pointer-to-function</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="c1"># reinsert temporarily removed commas</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  parameter#</span><span class="si">%(c)s</span><span class="s2">: (pointer to function) </span><span class="si">%(p)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^\(]+\(\*?\s*(\w*)\s*\)&quot;</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">p_name</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">p_type</span>  <span class="o">=</span> <span class="n">p</span>
                <span class="n">p_type</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([^\(]+\(\*?)\s*&quot;</span><span class="o">+</span><span class="n">p_name</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1&quot;</span><span class="p">,</span> <span class="n">p_type</span><span class="p">)</span>
                <span class="c1">#self.save_struct_actual(p_name)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_parameter</span><span class="p">(</span><span class="n">p_name</span><span class="p">,</span> <span class="n">p_type</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*:\s*&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*\[&quot;</span>  <span class="p">,</span> <span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  parameter#</span><span class="si">%(c)s</span><span class="s2">: (common) </span><span class="si">%(p)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

                <span class="n">p_args</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*,\s*&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s*,\s*&quot;</span><span class="p">,</span> <span class="n">p_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">p_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\*+)\s*&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot; \1&quot;</span><span class="p">,</span> <span class="n">p_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  parameter#</span><span class="si">%(c)s</span><span class="s2"> : (1) p_args = </span><span class="si">%(p_args)s</span><span class="s2">&quot;</span>
                           <span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">p_args</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">p_args</span><span class="p">))</span>

                <span class="n">first_arg</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(.*\s+)(.*?\[.*\].*)$&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">p_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">first_arg</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">first_arg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">first_arg</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">p_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>

                <span class="n">p_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_arg</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="p">]</span> <span class="o">+</span> <span class="n">p_args</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  parameter#</span><span class="si">%(c)s</span><span class="s2"> : (2) p_args=</span><span class="si">%(p_args)s</span><span class="s2">&quot;</span>
                           <span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">p_args</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">p_args</span><span class="p">))</span>
                <span class="n">p_type</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">first_arg</span><span class="p">)</span>

                <span class="n">ma</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\*+)\s*(.*)&quot;</span><span class="p">)</span>
                <span class="n">mb</span> <span class="o">=</span> <span class="n">RE</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(.*?):(\d+)&quot;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">p_name</span> <span class="ow">in</span> <span class="n">p_args</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  parameter#</span><span class="si">%(c)s</span><span class="s2"> : (3) p_name=&#39;</span><span class="si">%(p_name)s</span><span class="s2">&#39;&quot;</span>
                               <span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">p_name</span><span class="o">=</span><span class="n">p_name</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">ma</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p_name</span><span class="p">):</span>
                        <span class="n">p_type</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p_type</span><span class="p">,</span> <span class="n">ma</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">p_name</span> <span class="o">=</span> <span class="n">ma</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">elif</span> <span class="n">mb</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p_name</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">p_type</span><span class="p">:</span>
                            <span class="n">p_name</span> <span class="o">=</span> <span class="n">mb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">p_type</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p_type</span><span class="p">,</span> <span class="n">mb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># skip unnamed bit-fields</span>
                            <span class="k">continue</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;  parameter#</span><span class="si">%(c)s</span><span class="s2"> : (4) p_name=&#39;</span><span class="si">%(p_name)s</span><span class="s2">&#39; / p_type=&#39;</span><span class="si">%(p_type)s</span><span class="s2">&#39;&quot;</span>
                               <span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">p_name</span><span class="o">=</span><span class="n">p_name</span><span class="p">,</span> <span class="n">p_type</span><span class="o">=</span><span class="n">p_type</span><span class="p">)</span>
                    <span class="c1">#self.save_struct_actual(p_name)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">push_parameter</span><span class="p">(</span><span class="n">p_name</span><span class="p">,</span> <span class="n">p_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.push_parameter"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.push_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">push_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_name</span><span class="p">,</span> <span class="n">p_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;push_parameter(): p_name=&#39;</span><span class="si">%(p_name)s</span><span class="s2">&#39; / p_type=&#39;</span><span class="si">%(p_type)s</span><span class="s2">&#39;&quot;</span>
            <span class="p">,</span> <span class="n">p_name</span><span class="o">=</span><span class="n">p_name</span><span class="p">,</span> <span class="n">p_type</span><span class="o">=</span><span class="n">p_type</span><span class="p">)</span>
        <span class="n">p_name</span>  <span class="o">=</span> <span class="n">p_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">p_type</span>  <span class="o">=</span> <span class="n">p_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anon_struct_union</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">p_type</span>
            <span class="ow">and</span> <span class="n">p_name</span> <span class="o">==</span> <span class="s2">&quot;}&quot;</span><span class="p">):</span>
            <span class="c1"># ignore the ending }; from anon. struct/union</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">anon_struct_union</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;push_parameter(): (1) p_name=&#39;</span><span class="si">%(p_name)s</span><span class="s2">&#39; / p_type=&#39;</span><span class="si">%(p_type)s</span><span class="s2">&#39;&quot;</span>
            <span class="p">,</span> <span class="n">p_name</span><span class="o">=</span><span class="n">p_name</span><span class="p">,</span> <span class="n">p_type</span><span class="o">=</span><span class="n">p_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p_type</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.\.\.$&quot;</span><span class="p">,</span> <span class="n">p_name</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;variable arguments&quot;</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">p_type</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">p_name</span> <span class="ow">or</span> <span class="n">p_name</span> <span class="o">==</span> <span class="s2">&quot;void&quot;</span><span class="p">):</span>
            <span class="n">p_name</span> <span class="o">=</span> <span class="s2">&quot;void&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;no arguments&quot;</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">p_type</span> <span class="ow">and</span> <span class="p">(</span><span class="n">p_name</span> <span class="o">==</span> <span class="s2">&quot;struct&quot;</span> <span class="ow">or</span> <span class="n">p_name</span> <span class="o">==</span> <span class="s2">&quot;union&quot;</span><span class="p">):</span>
            <span class="c1"># handle unnamed (anonymous) union or struct:</span>
            <span class="n">p_type</span>  <span class="o">=</span> <span class="n">p_name</span>
            <span class="n">p_name</span> <span class="o">=</span> <span class="s2">&quot;{unnamed_&quot;</span> <span class="o">+</span> <span class="n">p_name</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;anonymous&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anon_struct_union</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;push_parameter(): (2) p_name=&#39;</span><span class="si">%(p_name)s</span><span class="s2">&#39; / p_type=&#39;</span><span class="si">%(p_type)s</span><span class="s2">&#39;&quot;</span>
            <span class="p">,</span> <span class="n">p_name</span><span class="o">=</span><span class="n">p_name</span><span class="p">,</span> <span class="n">p_type</span><span class="o">=</span><span class="n">p_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">p_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
            <span class="c1"># strip array from paramater name / e.g. p_name is &quot;modes[]&quot; from a</span>
            <span class="c1"># parmeter defined by: &quot;const char * const modes[]&quot;</span>

            <span class="n">p_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">p_name</span><span class="p">)</span>

            <span class="c1"># strip parentheses and pointers, e.g.: (*foo) --&gt; foo</span>

            <span class="n">p_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\*\(\)]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">p_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;push_parameter(): (3) p_name=&#39;</span><span class="si">%(p_name)s</span><span class="s2">&#39; / p_type=&#39;</span><span class="si">%(p_type)s</span><span class="s2">&#39;&quot;</span>
            <span class="p">,</span> <span class="n">p_name</span><span class="o">=</span><span class="n">p_name</span><span class="p">,</span> <span class="n">p_type</span><span class="o">=</span><span class="n">p_type</span><span class="p">)</span>

        <span class="c1"># warn if parameter has no description (but ignore ones starting with</span>
        <span class="c1"># &#39;#&#39; as these are not parameters but inline preprocessor statements);</span>
        <span class="c1"># also ignore unnamed structs/unions;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">anon_struct_union</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="n">p_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)):</span>

                <span class="k">if</span> <span class="n">p_type</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span> <span class="ow">or</span> <span class="n">p_type</span> <span class="o">==</span> <span class="s2">&quot;enum&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Function parameter or member &#39;</span><span class="si">%(p_name)s</span><span class="s2">&#39; not &quot;</span>
                              <span class="s2">&quot;described in &#39;</span><span class="si">%(decl_name)s</span><span class="s2">&#39;.&quot;</span>
                              <span class="p">,</span> <span class="n">p_name</span> <span class="o">=</span> <span class="n">p_name</span>
                              <span class="p">,</span> <span class="n">decl_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_name</span>
                              <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">last_offset</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;no description found for parameter &#39;</span><span class="si">%(p_name)s</span><span class="s2">&#39;&quot;</span>
                              <span class="p">,</span> <span class="n">p_name</span> <span class="o">=</span> <span class="n">p_name</span><span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterdescs</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Parser</span><span class="o">.</span><span class="n">undescribed</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parameterlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">parametertypes</span><span class="p">[</span><span class="n">p_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

    <span class="c1"># def save_struct_actual(self, actual):</span>
    <span class="c1">#     # strip all spaces from the actual param so that it looks like one</span>
    <span class="c1">#     # string item</span>
    <span class="c1">#     self.debug(&quot;save_struct_actual(): actual=&#39;%(a)s&#39;&quot;, a=actual)</span>
    <span class="c1">#     actual = WHITESPACE.sub(&quot;&quot;, actual)</span>
    <span class="c1">#     self.ctx.struct_actual += actual + &quot; &quot;</span>
    <span class="c1">#     self.debug(&quot;save_struct_actual: &#39;%(a)s&#39;&quot;, a=self.ctx.struct_actual)</span>


<div class="viewcode-block" id="Parser.check_sections"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.check_sections">[docs]</a>    <span class="k">def</span> <span class="nf">check_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decl_name</span><span class="p">,</span> <span class="n">decl_type</span>
                       <span class="p">,</span> <span class="n">sectcheck</span><span class="p">,</span> <span class="n">parameterlist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;check_sections(): decl_name=&#39;</span><span class="si">%(n)s</span><span class="s2">&#39; / decl_type=&#39;</span><span class="si">%(t)s</span><span class="s2">&#39; /&quot;</span>
                   <span class="s2">&quot; sectcheck=</span><span class="si">%(sc)s</span><span class="s2"> / parameterlist=</span><span class="si">%(pl)s</span><span class="s2">&quot;</span>
                   <span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">decl_name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">decl_type</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="n">sectcheck</span><span class="p">,</span> <span class="n">pl</span><span class="o">=</span><span class="n">parameterlist</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">sect</span> <span class="ow">in</span> <span class="n">sectcheck</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">parameterlist</span><span class="p">:</span>
                <span class="n">para</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[.*\]&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">para</span><span class="p">)</span>
                <span class="c1">#para = re.sub(r&quot;/__attribute__\s*\(\([A-Za-z,_\*\s\(\)]*\)\)/&quot;, &quot;&quot;, para)</span>
                <span class="k">if</span> <span class="n">para</span> <span class="o">==</span> <span class="n">sect</span><span class="p">:</span>
                    <span class="n">err</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">decl_type</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;excess function parameter &#39;</span><span class="si">%(sect)s</span><span class="s2">&#39; description in &#39;</span><span class="si">%(decl_name)s</span><span class="s2">&#39;&quot;</span>
                        <span class="p">,</span> <span class="n">sect</span> <span class="o">=</span> <span class="n">sect</span><span class="p">,</span> <span class="n">decl_name</span> <span class="o">=</span> <span class="n">decl_name</span>
                        <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;excess </span><span class="si">%(decl_type)s</span><span class="s2"> member &#39;</span><span class="si">%(sect)s</span><span class="s2">&#39; description in &#39;</span><span class="si">%(decl_name)s</span><span class="s2">&#39;&quot;</span>
                        <span class="p">,</span> <span class="n">decl_type</span> <span class="o">=</span> <span class="n">decl_type</span><span class="p">,</span> <span class="n">decl_name</span> <span class="o">=</span> <span class="n">decl_name</span><span class="p">,</span> <span class="n">sect</span> <span class="o">=</span> <span class="n">sect</span>
                        <span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;check_sections(): parameter &#39;</span><span class="si">%(sect)s</span><span class="s2">&#39;: description exists / OK&quot;</span>
                           <span class="p">,</span> <span class="n">sect</span><span class="o">=</span><span class="n">sect</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.check_return_section"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.Parser.check_return_section">[docs]</a>    <span class="k">def</span> <span class="nf">check_return_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decl_name</span><span class="p">,</span> <span class="n">return_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;check_return_section(): decl_name=&#39;</span><span class="si">%(n)s</span><span class="s2">&#39;, return_type=&#39;</span><span class="si">%(t)s</span><span class="s2">&quot;</span>
                   <span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">decl_name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">return_type</span><span class="p">)</span>
        <span class="c1"># Ignore an empty return type (It&#39;s a macro) and ignore functions with a</span>
        <span class="c1"># &quot;void&quot; return type. (But don&#39;t ignore &quot;void *&quot;)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">return_type</span>
            <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;void\s*\w*\s*$&quot;</span><span class="p">,</span> <span class="n">return_type</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;check_return_section(): ignore void&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">verbose_warn</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">section_return</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;no description found for return-value of function &#39;</span><span class="si">%(func)s</span><span class="s2">()&#39;&quot;</span>
                      <span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">decl_name</span><span class="p">,</span> <span class="n">line_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctx</span><span class="o">.</span><span class="n">decl_offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;check_return_section(): return-value of </span><span class="si">%(func)s</span><span class="s2">() OK&quot;</span>
                      <span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">decl_name</span><span class="p">)</span></div></div>

<span class="c1"># ==============================================================================</span>
<span class="c1"># 2cent debugging &amp; introspection</span>
<span class="c1"># ==============================================================================</span>

<div class="viewcode-block" id="CONSOLE"><a class="viewcode-back" href="../../linuxdoc-api/linuxdoc.kernel_doc.html#linuxdoc.kernel_doc.CONSOLE">[docs]</a><span class="k">def</span> <span class="nf">CONSOLE</span><span class="p">(</span><span class="n">arround</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># pylint: disable=C0321,C0410</span>
    <span class="kn">import</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">code</span><span class="o">,</span> <span class="nn">linecache</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="n">frame</span>  <span class="o">=</span> <span class="n">frame</span> <span class="ow">or</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
    <span class="n">fName</span>  <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_filename</span>
    <span class="n">lineNo</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_lineno</span>

    <span class="n">ns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">)</span>
    <span class="n">ns</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">)</span>

    <span class="n">histfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span> <span class="s2">&quot;.kernel-doc-history&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">readline</span><span class="o">,</span> <span class="nn">rlcompleter</span>  <span class="c1"># pylint: disable=W0612</span>
        <span class="n">readline</span><span class="o">.</span><span class="n">set_completer</span><span class="p">(</span><span class="n">rlcompleter</span><span class="o">.</span><span class="n">Completer</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">complete</span><span class="p">)</span>
        <span class="n">readline</span><span class="o">.</span><span class="n">parse_and_bind</span><span class="p">(</span><span class="s2">&quot;tab: complete&quot;</span><span class="p">)</span>
        <span class="n">readline</span><span class="o">.</span><span class="n">set_history_length</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">histfile</span><span class="p">):</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">read_history_file</span><span class="p">(</span><span class="n">histfile</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">readline</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lines</span>  <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lineNo</span> <span class="o">-</span> <span class="n">arround</span><span class="p">,</span> <span class="n">lineNo</span> <span class="o">+</span> <span class="n">arround</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%-04s</span><span class="s2">|&quot;</span> <span class="o">%</span> <span class="n">c</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">lineNo</span><span class="p">:</span>   <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;----&gt;&quot;</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">linecache</span><span class="o">.</span><span class="n">getline</span><span class="p">(</span><span class="n">fName</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lines</span><span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;EOF&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">break</span>
    <span class="n">banner</span> <span class="o">=</span>  <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;file: </span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fName</span><span class="p">,</span> <span class="n">lineNo</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">code</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">banner</span><span class="o">=</span><span class="n">banner</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="n">ns</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">readline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">write_history_file</span><span class="p">(</span><span class="n">histfile</span><span class="p">)</span></div>

<span class="c1"># ==============================================================================</span>
<span class="c1"># run ...</span>
<span class="c1"># ==============================================================================</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># FIXME: just for testing</span>
    <span class="n">__builtins__</span><span class="p">[</span><span class="s2">&quot;CONSOLE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CONSOLE</span>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017 Markus Heiser.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'20170614',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>